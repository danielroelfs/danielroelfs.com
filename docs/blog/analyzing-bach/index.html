<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Daniel Roelfs">
    <meta name="description" content="/">
    <meta name="keywords" content="blog,personal,coding">

    <meta property="og:site_name" content="Daniel Roelfs">
    <meta property="og:title" content="
  Analyzing Bach - Daniel Roelfs
">
    <meta property="og:description" content="Analyzing Bach">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/blog/analyzing-bach/">
    <meta property="og:image" content="/images/avatar.png">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="/blog/analyzing-bach/">
    <meta name="twitter:image" content="/images/avatar.png">

    <base href="/blog/analyzing-bach/">
    <title>
  Analyzing Bach - Daniel Roelfs
</title>

    <link rel="canonical" href="/blog/analyzing-bach/">
    
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css">
    
    <link rel="preconnect" href="https://fonts.gstatic.com"> 
    <link href="https://fonts.googleapis.com/css2?family=Alegreya:ital,wght@0,400;0,700;1,400;1,700&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Nunito+Sans:ital,wght@0,400;0,700;0,800;0,900;1,400;1,700;1,800;1,900&display=swap" rel="stylesheet">    <link rel="stylesheet" href="/css/normalize.min.css">
    <link rel="stylesheet" href="/css/style.min.css">

    

    

    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

    
      <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Daniel Roelfs">
      <link href="/index.xml" rel="feed" type="application/rss+xml" title="Daniel Roelfs" />
    

    
      <script async defer data-website-id="a99db70b-d24d-44cd-a49a-8524d9b74793" src="https://analytics-danielroelfs.herokuapp.com/umami.js"></script>
      <script async defer data-website-id="6379c080-9ab8-4fa1-9b8e-ffef41e186f3" src="https://analytics-danielroelfs-dev.herokuapp.com/umami.js"></script>
    

    <meta name="generator" content="Hugo 0.92.1" />
  </head>

  <body class="">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">Daniel Roelfs</a>
    <input type="checkbox" id="menu-control"/>
    <label class="menu-mobile  float-right " for="menu-control">
      <span class="btn-mobile  float-right ">&#9776;</span>
      <ul class="navigation-list">
        
          
            <li class="navigation-item  align-center ">
              <a class="navigation-link" href="/blog">Blog</a>
            </li>
          
            <li class="navigation-item  align-center ">
              <a class="navigation-link" href="/photography">Photography</a>
            </li>
          
            <li class="navigation-item  align-center ">
              <a class="navigation-link" href="/publications">Publications</a>
            </li>
          
            <li class="navigation-item  align-center ">
              <a class="navigation-link" href="/cv">Curriculum Vitæ</a>
            </li>
          
            <li class="navigation-item  align-center ">
              <a class="navigation-link" href="/about">About</a>
            </li>
          
        
        
      </ul>
    </label>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
  <article>
    <header>
      <h1 class="post-title">Analyzing Bach</h1> 
      <h2 class="date">December 1, 2019</h2>

      
    </header>

    <style type="text/css">
@import url('https://fonts.googleapis.com/css?family=IM+Fell+English|IM+Fell+English+SC&display=swap');
body{
  background-color: #FFFFF0;
}

h1 {
  font-family: 'IM Fell English', serif;
}
h2,h3,h4,h5,h6 {
  font-family: 'IM Fell English', serif;
}
.post-title {
  font-family: 'IM Fell English SC', serif;
  font-size: 6rem;
}
</style>
<!-- ******************************************************************* -->
<h2 id="introduction">Introduction</h2>
<p>A little while ago I was watching a documentary series on Dutch
television about one of the most important composers in the Netherlands:
Johann Sebastian Bach. The documentary discussed parts of Bach&rsquo;s life
and the music he wrote during it. This documentary inspired me to learn
more about the pieces Bach wrote, and since this is my life now, I might
as well do it in R.</p>
<!-- ******************************************************************* -->
<h2 id="collecting-the-data">Collecting the data</h2>
<p>In my search of a dataset, I found this old website, looking like it
last got a major update in 2003, made by what appeared to be a Bach
enthousiast called Bryen Travis. I tried to contact him to see if he was
interested in collaborating, but I couldn&rsquo;t get a hold of him. This
website contained a list of all works by Bach, with some information
about each of them. The website listed a few options, an online browser,
a pdf containing slimmed down entries, and two files that I couldn&rsquo;t get
to work, presumably because they were in a format that have presumably
become depracated since they were uploaded back in 1996, when the
website was created. I could have used the pdf, but since it contained
only the BWV number, the title of the piece, and the setting, I had to
scrape the data I wanted from the website directly.</p>
<h2 id="list-of-bwvs">List of BWVs</h2>
<p>The website browser contains an index which lists the links to each BWV.
Each BWV has its own html page in a subfolder. Thankfully, the html
pages were referred by BWV number, and not title, this made my next job
a lot easier. I decided to obtain the list of available BWVs from the
index page. There in total 1128 BWVs since a new piece was attributed to
Bach in 2008. However, the website doesn&rsquo;t list all of them. The largest
number is 1120, but there&rsquo;s some numbers missing (e.g. 141 and 142), and
some duplicate links too (e.g. 147). Therefore I couldn&rsquo;t just loop from
1 through 1120, but had to extract just the numbers available. The code
for this is definitely a bit messy, but let&rsquo;s have a look anyway. In
short, I read the html page as a character vecetor. I get all instances
when there&rsquo;s a link (identified by the <code>href</code> tag), convert it from a
list to a vector, extract only the unique values, and then select only
the links where there&rsquo;s numbers in front of a <code>.html</code> string. I convert
it to a character string again, and extract now only the numbers. I&rsquo;m
99% sure that there is a more efficient way to do this, but this was the
best I could think of.</p>
<p>The packages I&rsquo;ll use in this post are the following. The <code>{danielR}</code>
package is a package with my personal preferences, such as the origin of
the <code>theme_bach()</code> function and the colors I&rsquo;ll use for the plotting,
which come from the <code>{dutchmasters}</code> package.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">rvest</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">waffle</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggmap</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">danielR</span><span class="p">)</span>
</code></pre></div><p>Let&rsquo;s collect the BWVs:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">index_url</span> <span class="o">&lt;-</span> <span class="s">&#34;http://www.bachcentral.com/BWV/index.html&#34;</span>
<span class="n">BWVs</span> <span class="o">&lt;-</span> <span class="nf">paste</span><span class="p">(</span><span class="nf">readLines</span><span class="p">(</span><span class="n">index_url</span><span class="p">),</span> <span class="n">collapse</span> <span class="o">=</span> <span class="s">&#34;\n&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">str_match_all</span><span class="p">(</span><span class="s">&#34;&lt;a href=\&#34;(.*?)\&#34;&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">unlist</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">unique</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">str_extract_all</span><span class="p">(</span><span class="s">&#34;[0-9]+.html&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">unlist</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">unique</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">str_extract_all</span><span class="p">(</span><span class="s">&#34;[0-9]+&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">as.character</span><span class="p">()</span>
<span class="nf">str</span><span class="p">(</span><span class="n">BWVs</span><span class="p">)</span>
</code></pre></div><pre><code> chr [1:1075] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; &quot;6&quot; &quot;7&quot; &quot;8&quot; &quot;9&quot; &quot;10&quot; &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; ...
</code></pre>
<p>I now have a list of 1075 numbers, corresponding to BWV numbers of which
this website has an entry. The next thing I needed to do now was loop
over these numbers, navigate to each of the webpages corresponding to
that link, and scrape all 1075 webpages individually. This takes a
little bit of time, but luckily the author of the pages was very
consistent in the setup, so I didn&rsquo;t need to build in fail-safes or
condititions to account for irregularities. Before we&rsquo;ll do that, I
first initialized a data frame with the correct size for speed. I added
the column names for convenience too.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">col_names</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;Title&#34;</span><span class="p">,</span> <span class="s">&#34;Subtitle_and_notes&#34;</span><span class="p">,</span> 
               <span class="s">&#34;BWV&#34;</span><span class="p">,</span> <span class="s">&#34;BWV_epifix&#34;</span><span class="p">,</span> <span class="s">&#34;CLC_BWV_w_epifix&#34;</span><span class="p">,</span> <span class="s">&#34;belongs after&#34;</span><span class="p">,</span> 
               <span class="s">&#34;voices_instruments&#34;</span><span class="p">,</span> 
               <span class="s">&#34;category1&#34;</span><span class="p">,</span> <span class="s">&#34;category2&#34;</span><span class="p">,</span> <span class="s">&#34;category3&#34;</span><span class="p">,</span>
               <span class="s">&#34;cantate_cat1&#34;</span><span class="p">,</span> <span class="s">&#34;cantate_cat2&#34;</span><span class="p">)</span>

<span class="n">scraped_data</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="nf">matrix</span><span class="p">(</span><span class="n">ncol</span> <span class="o">=</span> <span class="m">12</span><span class="p">,</span> <span class="n">nrow</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span><span class="n">BWVs</span><span class="p">)))</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">scraped_data</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">col_names</span>
</code></pre></div><h2 id="scraping-the-data">Scraping the data</h2>
<p>We now have a variable of the same dimensions and column names as I&rsquo;ll
scrape from the website. Now it&rsquo;s time to loop through the webpages and
collect the data. Each webpage contains what looks like a table, but
within the table it&rsquo;s bulleted lists (denoted as <code>ul</code>). This might just
be how html builds up tables, but I thought it was a bit strange.
Nonetheless, it provided me with an easy hook to grab the values. I
remove all the white spaces (<code>\t</code>), and each new line was denoted by a
<code>\n</code>, which I used to split the strings into separate values. The
advantage of this approach is that when a field is empty, it will still
occupy an element in the character array. Then all I needed to do to
obtain the values is take every second element and add it as a row to
the data frame I created earlier. Now I have a dataset containing the
values from all of the 1075 webpages, with which I was quite pleased.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">BWVs</span><span class="p">))</span> <span class="p">{</span>
  
  <span class="nf">print</span><span class="p">(</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&#34;Scraping data for BWV %s&#34;</span><span class="p">,</span> <span class="n">BWVs[i]</span><span class="p">))</span>
  
  <span class="n">url</span> <span class="o">&lt;-</span> <span class="nf">sprintf</span><span class="p">(</span><span class="s">&#34;http://www.bachcentral.com/BWV/%s.html&#34;</span><span class="p">,</span> <span class="n">BWVs[i]</span><span class="p">)</span>
  <span class="n">webpage</span> <span class="o">&lt;-</span> <span class="nf">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  
  <span class="n">text</span> <span class="o">&lt;-</span> <span class="n">webpage</span> <span class="o">%&gt;%</span>
    <span class="nf">html_nodes</span><span class="p">(</span><span class="s">&#34;ul&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">html_text</span><span class="p">()</span> <span class="o">%&gt;%</span>
    <span class="nf">gsub</span><span class="p">(</span><span class="s">&#39;[\t]&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">.)</span> <span class="o">%&gt;%</span>
    <span class="nf">strsplit</span><span class="p">(</span><span class="n">.,</span> <span class="s">&#34;\\n&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">unlist</span><span class="p">()</span>
  
  <span class="n">values</span> <span class="o">&lt;-</span> <span class="n">text</span><span class="nf">[seq</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="nf">length</span><span class="p">(</span><span class="n">text</span><span class="p">),</span><span class="m">2</span><span class="p">)</span><span class="n">]</span>
  
  <span class="n">scraped_data[i</span><span class="p">,</span> <span class="n">]</span> <span class="o">&lt;-</span> <span class="n">values</span>
  
<span class="p">}</span>
</code></pre></div><p>With this, I achieved the first goal I had for this little project,
which was to find or create a dataset on Bach. Let&rsquo;s see what it looks
like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="nf">str</span><span class="p">(</span><span class="n">scraped_data</span><span class="p">)</span>
</code></pre></div><pre><code>'data.frame':   1075 obs. of  12 variables:
 $ Title             : chr  &quot;Wie schön leuchtet der Morgenstern&quot; &quot;Ach Gott, von Himmel sieh darein&quot; &quot;Ach Gott, wie manches Herzeleid&quot; &quot;Christ lag in Todes Banden&quot; ...
 $ Subtitle_and_notes: chr  &quot;Kantate am Fest Mariae Verkündigung (Festo annuntiationis Mariae)&quot; &quot;Kantate am zweiten Sonntag nach Trinitatis (Dominica 2 post Trinitatis)&quot; &quot;Kantate am zweiten Sonntag nach Epiphanias (Dominica 2 post Epiphanias)&quot; &quot;Kantate am Osterfest (Feria Paschatos)&quot; ...
 $ BWV               : chr  &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
 $ BWV_epifix        : chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
 $ CLC_BWV_w_epifix  : chr  &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
 $ belongs after     : chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
 $ voices_instruments: chr  &quot;Soli: S, T, B. Chor: S, A, T, B. Instr.: Corno I, II; Ob. da caccia I, II; Viol. conc. I, II; Viol. rip. I, II; Vla.; Cont.&quot; &quot;Soli: A, T, B. Chor: S, A, T, B. Instr.: Tromb. I - IV; Ob. I, II; Viol. I, II; Vla.; Cont.&quot; &quot;Soli: S, A, T, B. Chor: S, A, T, B. Instr.: Corno; Tromb.; Ob. d'amore I, II; Viol. I, II; Vla.; Cont.&quot; &quot;Soli: S, A, T, B. Chor: S, A, T, B. Instr.: Cornetto; Tromb. I, II, III; Viol. I, II; Vla. I, II; Cont.&quot; ...
 $ category1         : chr  &quot;Vokalwerke&quot; &quot;Vokalwerke&quot; &quot;Vokalwerke&quot; &quot;Vokalwerke&quot; ...
 $ category2         : chr  &quot;Kantaten&quot; &quot;Kantaten&quot; &quot;Kantaten&quot; &quot;Kantaten&quot; ...
 $ category3         : chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
 $ cantate_cat1      : chr  &quot;A. Geistliche Kantaten an der Sonn- und Festtagen des Kirchenjahres&quot; &quot;A. Geistliche Kantaten an der Sonn- und Festtagen des Kirchenjahres&quot; &quot;A. Geistliche Kantaten an der Sonn- und Festtagen des Kirchenjahres&quot; &quot;A. Geistliche Kantaten an der Sonn- und Festtagen des Kirchenjahres&quot; ...
 $ cantate_cat2      : chr  &quot;Mariae Verkundigung&quot; &quot;2. Sonntag nach Trinitatis&quot; &quot;2. Sonntag nach Epiphanias&quot; &quot;1. Osterfesttag&quot; ...
</code></pre>
<p>All columns are currently character arrays, and this is appropriate for
most of them. Although I think the BWV number alone could be a numeric
array. Also, some columns are still a bit awkward. This is why I moved
on to do another important and satisfying part, cleaning the data.</p>
<h2 id="cleaning-the-data">Cleaning the data</h2>
<p>The character arrays are appropriate, but for further analyes I&rsquo;d prefer
to make at least the categories explicitely factorial. Then I&rsquo;ll also
rename awkwardly named columns, and reorder the columns to start with
the BWV instead of the number title.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">data</span> <span class="o">&lt;-</span> <span class="n">scraped_data</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">BWV</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">BWV</span><span class="p">),</span>
         <span class="n">category1</span> <span class="o">=</span> <span class="nf">factor</span><span class="p">(</span><span class="n">category1</span><span class="p">),</span>
         <span class="n">category2</span> <span class="o">=</span> <span class="nf">factor</span><span class="p">(</span><span class="n">category2</span><span class="p">),</span>
         <span class="n">category3</span> <span class="o">=</span> <span class="nf">factor</span><span class="p">(</span><span class="n">category3</span><span class="p">),</span>
         <span class="n">cantate_cat1</span> <span class="o">=</span> <span class="nf">substring</span><span class="p">(</span><span class="n">cantate_cat1</span><span class="p">,</span><span class="m">4</span><span class="p">),</span>
         <span class="n">CLC_BWV_w_epifix</span> <span class="o">=</span> <span class="nf">str_replace</span><span class="p">(</span><span class="n">CLC_BWV_w_epifix</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="nf">rename</span><span class="p">(</span><span class="n">BWV_w_epifix</span> <span class="o">=</span> <span class="n">CLC_BWV_w_epifix</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">select</span><span class="p">(</span><span class="n">BWV</span><span class="p">,</span> <span class="n">BWV_epifix</span><span class="p">,</span> <span class="n">BWV_w_epifix</span><span class="p">,</span> <span class="nf">everything</span><span class="p">())</span>
<span class="nf">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div><pre><code>'data.frame':   1075 obs. of  12 variables:
 $ BWV               : num  1 2 3 4 5 6 7 8 9 10 ...
 $ BWV_epifix        : chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
 $ BWV_w_epifix      : chr  &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
 $ Title             : chr  &quot;Wie schön leuchtet der Morgenstern&quot; &quot;Ach Gott, von Himmel sieh darein&quot; &quot;Ach Gott, wie manches Herzeleid&quot; &quot;Christ lag in Todes Banden&quot; ...
 $ Subtitle_and_notes: chr  &quot;Kantate am Fest Mariae Verkündigung (Festo annuntiationis Mariae)&quot; &quot;Kantate am zweiten Sonntag nach Trinitatis (Dominica 2 post Trinitatis)&quot; &quot;Kantate am zweiten Sonntag nach Epiphanias (Dominica 2 post Epiphanias)&quot; &quot;Kantate am Osterfest (Feria Paschatos)&quot; ...
 $ belongs after     : chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
 $ voices_instruments: chr  &quot;Soli: S, T, B. Chor: S, A, T, B. Instr.: Corno I, II; Ob. da caccia I, II; Viol. conc. I, II; Viol. rip. I, II; Vla.; Cont.&quot; &quot;Soli: A, T, B. Chor: S, A, T, B. Instr.: Tromb. I - IV; Ob. I, II; Viol. I, II; Vla.; Cont.&quot; &quot;Soli: S, A, T, B. Chor: S, A, T, B. Instr.: Corno; Tromb.; Ob. d'amore I, II; Viol. I, II; Vla.; Cont.&quot; &quot;Soli: S, A, T, B. Chor: S, A, T, B. Instr.: Cornetto; Tromb. I, II, III; Viol. I, II; Vla. I, II; Cont.&quot; ...
 $ category1         : Factor w/ 2 levels &quot;Instrumentalwerke&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
 $ category2         : Factor w/ 15 levels &quot;Kammermusik&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...
 $ category3         : Factor w/ 26 levels &quot;&quot;,&quot;Choralbearbeitungen&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
 $ cantate_cat1      : chr  &quot;Geistliche Kantaten an der Sonn- und Festtagen des Kirchenjahres&quot; &quot;Geistliche Kantaten an der Sonn- und Festtagen des Kirchenjahres&quot; &quot;Geistliche Kantaten an der Sonn- und Festtagen des Kirchenjahres&quot; &quot;Geistliche Kantaten an der Sonn- und Festtagen des Kirchenjahres&quot; ...
 $ cantate_cat2      : chr  &quot;Mariae Verkundigung&quot; &quot;2. Sonntag nach Trinitatis&quot; &quot;2. Sonntag nach Epiphanias&quot; &quot;1. Osterfesttag&quot; ...
</code></pre>
<p>Now we have this data, we can do some descriptive visualizations of the
data. Over time I hope I can dive into the setting
(<code>voices_instruments</code>) and disect that, but for now I&rsquo;ll keep it simple
and just do some descriptives.</p>
<h2 id="visualizations">Visualizations</h2>
<p>The first descritive I wanted to see was what kind of work Bach wrote
and in what numbers. First the main category, which differentiates
between choral pieces and instrumental pieces.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">data</span> <span class="o">%&gt;%</span>
  <span class="nf">group_by</span><span class="p">(</span><span class="n">category1</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">summarise</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="nf">n</span><span class="p">())</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">category1</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">category1</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">xend</span> <span class="o">=</span> <span class="n">category1</span><span class="p">,</span> <span class="n">yend</span> <span class="o">=</span> <span class="m">0</span><span class="p">),</span> <span class="n">size</span> <span class="o">=</span> <span class="m">12</span><span class="p">,</span> 
               <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;grey40&#34;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.9</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">20</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="m">16</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">geom_text</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="m">5</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">5</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="s">&#34;Alegreya&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
       <span class="n">y</span> <span class="o">=</span> <span class="s">&#34;Number of compositions&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_color_daniel</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s">&#34;staalmeesters&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">650</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">theme_bach</span><span class="p">(</span><span class="n">base_family</span> <span class="o">=</span> <span class="s">&#34;Alegreya&#34;</span><span class="p">,</span> <span class="n">grid</span> <span class="o">=</span> <span class="s">&#34;y&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span>
    <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&#34;none&#34;</span><span class="p">,</span>
    <span class="n">aspect.ratio</span> <span class="o">=</span> <span class="m">3</span><span class="o">/</span><span class="m">2</span><span class="p">,</span>
    <span class="n">axis.text.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="m">45</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="m">1.1</span><span class="p">,</span> <span class="n">vjust</span> <span class="o">=</span> <span class="m">1.15</span><span class="p">))</span>
</code></pre></div><img src="index_files/figure-gfm/lollipop-cat1-1.png" width="768" />
<p>It seems Bach didn&rsquo;t have a strong preference for either instrumental or
choral music. I suppose he didn&rsquo;t have infinite freedom with what to
compose, since his employer might also request him to compose certain
types of music. I wanted to see the same for the secondary category,
which differentias between the type of composition (e.g. cantate,
passions, organ pieces, symphonies, and so on).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">data</span> <span class="o">%&gt;%</span>
  <span class="nf">group_by</span><span class="p">(</span><span class="n">category2</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">summarise</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="nf">n</span><span class="p">())</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="nf">reorder</span><span class="p">(</span><span class="n">category2</span><span class="p">,</span><span class="o">-</span><span class="n">n</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">category2</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">xend</span> <span class="o">=</span> <span class="n">category2</span><span class="p">,</span> <span class="n">yend</span> <span class="o">=</span> <span class="m">0</span><span class="p">),</span> <span class="n">size</span> <span class="o">=</span> <span class="m">6</span><span class="p">,</span> 
               <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;grey40&#34;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.9</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">10</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="m">16</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">geom_text</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="m">3</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">4</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="s">&#34;Alegreya&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
       <span class="n">y</span> <span class="o">=</span> <span class="s">&#34;Number of compositions&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_color_daniel</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s">&#34;staalmeesters&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">-5</span><span class="p">,</span><span class="m">300</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">theme_bach</span><span class="p">(</span><span class="n">base_family</span> <span class="o">=</span> <span class="s">&#34;Alegreya&#34;</span><span class="p">,</span> <span class="n">grid</span> <span class="o">=</span> <span class="s">&#34;y&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span>
    <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&#34;none&#34;</span><span class="p">,</span>
    <span class="n">axis.text.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="m">45</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="m">1.05</span><span class="p">,</span> <span class="n">vjust</span> <span class="o">=</span> <span class="m">1.025</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div><img src="index_files/figure-gfm/lollipop-cat2-1.png" width="768" />
<p>From this it seems that most of the intrumental pieces are made up by
just solo pieces for organ and the harpsichord and that the choral
pieces are made up mostly by cantates and chorales for four voices.
While I appreciate the information dissemination qualities of a barplot
(or lollipop plot) like this, in that it&rsquo;s good in communicating
absolute quantities (while I admit that this could also be displayed in
a table). One thing it is less good at, is communicating the subjective
volume of the works. There&rsquo;s more than a thousand pieces in the BWV, and
I feel that the plots above don&rsquo;t do a good enough job at communicating
just how many pieces this is. Therefore, I created a tile plot (using
<code>{ggwaffle}</code>), where every tile represents one piece. I colored again
based on the secondary category. In order to still maintain the
quantities of each category, I added the number of compositions to the
legend.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">data</span> <span class="o">%&gt;%</span>
  <span class="nf">group_by</span><span class="p">(</span><span class="n">category2</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">summarise</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="nf">n</span><span class="p">())</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">category2</span> <span class="o">=</span> <span class="nf">sprintf</span><span class="p">(</span><span class="s">&#34;%s (%s)&#34;</span><span class="p">,</span> <span class="n">category2</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="n">category2</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">n</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_waffle</span><span class="p">(</span><span class="n">n_rows</span> <span class="o">=</span> <span class="m">17</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="s">&#34;#FFFFFC&#34;</span><span class="p">,</span> <span class="n">flip</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_fill_daniel</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s">&#34;staalmeesters&#34;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">coord_equal</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme_bach</span><span class="p">(</span><span class="n">base_family</span> <span class="o">=</span> <span class="s">&#34;Alegreya&#34;</span><span class="p">,</span> <span class="n">base_size</span> <span class="o">=</span> <span class="m">14</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme_enhance_waffle</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span>
    <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&#34;bottom&#34;</span>
  <span class="p">)</span>
</code></pre></div><img src="index_files/figure-gfm/waffle-1.png" width="1152" />
<h2 id="scraping-wikipedia">Scraping Wikipedia</h2>
<p>The dataset I just created was comprehensive and clean, but it didn&rsquo;t
contain any information about the musical properties other than the
setting. I want to dive into the setting later, but it&rsquo;s going to be a
regular expression hell. I might come back to that later. In the
meantime, Wikipedia has a page listing the compositions by Bach too
(because of course Wikipedia does). This page contains approximate dates
on each composition, as well as the key it was written in. I&rsquo;m going to
scrape this webpage too. The setup of this page was somewhat simpler, so
scraping it was slightly simpler.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">url</span> <span class="o">&lt;-</span> <span class="s">&#34;https://en.wikipedia.org/wiki/List_of_compositions_by_Johann_Sebastian_Bach&#34;</span>
<span class="n">webpage</span> <span class="o">&lt;-</span> <span class="nf">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="n">wikitext</span> <span class="o">&lt;-</span> <span class="n">webpage</span> <span class="o">%&gt;%</span>
  <span class="nf">html_nodes</span><span class="p">(</span><span class="n">xpath</span><span class="o">=</span><span class="s">&#39;//*[@id=&#34;TOP&#34;]&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">html_table</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">as.data.frame</span><span class="p">()</span>
</code></pre></div><p>Then I cleaned the data somewhat and extracted the number from the BWV
columns.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">wikidata</span> <span class="o">&lt;-</span> <span class="n">wikitext</span> <span class="o">%&gt;%</span>
  <span class="nf">rename</span><span class="p">(</span><span class="n">BWV_full</span> <span class="o">=</span> <span class="n">BWV</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">BWV</span> <span class="o">=</span> <span class="nf">sub</span><span class="p">(</span><span class="s">&#39;.*(\\d{3}).*&#39;</span><span class="p">,</span> <span class="s">&#39;\\1&#39;</span><span class="p">,</span> <span class="n">BWV_full</span><span class="p">),</span>
         <span class="n">BWV</span> <span class="o">=</span> <span class="nf">parse_integer</span><span class="p">(</span><span class="n">BWV</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">rev</span><span class="p">(</span><span class="nf">duplicated</span><span class="p">(</span><span class="nf">rev</span><span class="p">(</span><span class="n">BWV</span><span class="p">))))</span>
</code></pre></div><p>Then I merged the data. I lost a number of compositions in the process,
but I was okay with it, mostly because it took me too much time and
effort to try and fix it. Hurray for laziness. I extracted the year from
the slightly messy <code>Date</code> column. Some strings in this column contain
two dates, one for the first compilation and one for the date of
completion. I extracted the last number, the year of completion.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">merged_data</span> <span class="o">&lt;-</span> <span class="nf">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">wikidata</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s">&#34;BWV&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">year</span> <span class="o">=</span> <span class="nf">sub</span><span class="p">(</span><span class="s">&#34;.*(\\d{4}).*&#34;</span><span class="p">,</span> <span class="s">&#34;\\1&#34;</span><span class="p">,</span> <span class="n">Date</span><span class="p">),</span>
         <span class="n">year</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">year</span><span class="p">),</span>
         <span class="n">age</span> <span class="o">=</span> <span class="n">year</span> <span class="o">-</span> <span class="m">1685</span><span class="p">)</span>
</code></pre></div><p>I noticed that some entries in the <code>year</code> column exceeded the year of
Bach&rsquo;s death. Bach died in 1750. I assumed that these years indicated
the year of first performance or publication. In this scenario, it would
be possible that certain pieces were lost and rediscovered at a later
date and only then published. I thought to make a barplot of the number
of compositions Bach over the course of his life, trying to see if there
was any period where he was particularly productive. I also added some
annotations to give the plot some context.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">BWVperyear</span> <span class="o">&lt;-</span> <span class="n">merged_data</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">year</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="nf">group_by</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">age</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">summarise</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="nf">n</span><span class="p">())</span>

<span class="n">palette</span> <span class="o">&lt;-</span> <span class="nf">daniel_pal</span><span class="p">(</span><span class="s">&#34;staalmeesters&#34;</span><span class="p">)(</span><span class="m">6</span><span class="p">)</span>

<span class="n">annotation1</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span>
  <span class="n">x</span> <span class="o">=</span> <span class="m">1701</span><span class="p">,</span>
  <span class="n">y</span> <span class="o">=</span> <span class="m">34</span><span class="p">,</span>
  <span class="n">xend</span> <span class="o">=</span> <span class="m">1699</span><span class="p">,</span>
  <span class="n">yend</span> <span class="o">=</span> <span class="m">10</span><span class="p">,</span>
  <span class="n">text</span> <span class="o">=</span> <span class="s">&#34;Bach is 14\nyears old&#34;</span>
<span class="p">)</span>

<span class="n">annotation2</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span>
  <span class="n">x</span> <span class="o">=</span> <span class="m">1726.5</span><span class="p">,</span>
  <span class="n">y</span> <span class="o">=</span> <span class="m">72</span><span class="p">,</span>
  <span class="n">xend</span> <span class="o">=</span> <span class="m">1735</span><span class="p">,</span>
  <span class="n">yend</span> <span class="o">=</span> <span class="m">60</span><span class="p">,</span>
  <span class="n">text</span> <span class="o">=</span> <span class="s">&#34;italic(Schemellis~Gesangbuch)~comes~out&#34;</span>
<span class="p">)</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">BWVperyear</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">year</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">n</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_bar</span><span class="p">(</span><span class="n">stat</span> <span class="o">=</span> <span class="s">&#34;identity&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_vline</span><span class="p">(</span><span class="n">xintercept</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1750.5</span><span class="p">,</span><span class="m">1685</span><span class="p">),</span> <span class="n">linetype</span> <span class="o">=</span> <span class="s">&#34;dashed&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;grey30&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_text</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="nf">data.frame</span><span class="p">(),</span> <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="m">1685.5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="m">75</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&#34;Bach was born\nMarch 31st 1685\nin Eisenach&#34;</span><span class="p">),</span>
            <span class="n">inherit.aes</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="s">&#34;Alegreya&#34;</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="m">0</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_text</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="nf">data.frame</span><span class="p">(),</span> <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="m">1750</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="m">75</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&#34;Bach died\nJuly 28th 1750\nin Leipzich&#34;</span><span class="p">),</span>
            <span class="n">inherit.aes</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="s">&#34;Alegreya&#34;</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_curve</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">annotation1</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">xend</span> <span class="o">=</span> <span class="n">xend</span><span class="p">,</span> <span class="n">yend</span> <span class="o">=</span> <span class="n">yend</span><span class="p">),</span>
             <span class="n">arrow</span> <span class="o">=</span> <span class="nf">arrow</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="m">25</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="s">&#34;pt&#34;</span><span class="p">)),</span> 
             <span class="n">curvature</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">,</span> <span class="n">inherit.aes</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_text</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">annotation1</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="m">4</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">text</span><span class="p">),</span>
            <span class="n">family</span> <span class="o">=</span> <span class="s">&#34;Alegreya&#34;</span><span class="p">,</span> <span class="n">inherit.aes</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">parse</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_curve</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">annotation2</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">xend</span> <span class="o">=</span> <span class="n">xend</span><span class="p">,</span> <span class="n">yend</span> <span class="o">=</span> <span class="n">yend</span><span class="p">),</span>
             <span class="n">arrow</span> <span class="o">=</span> <span class="nf">arrow</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="m">25</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="s">&#34;pt&#34;</span><span class="p">)),</span> 
             <span class="n">curvature</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">,</span> <span class="n">inherit.aes</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_text</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">annotation2</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="m">3</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">text</span><span class="p">),</span>
            <span class="n">family</span> <span class="o">=</span> <span class="s">&#34;Alegreya&#34;</span><span class="p">,</span> <span class="n">inherit.aes</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">parse</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s">&#34;Year&#34;</span><span class="p">,</span>
       <span class="n">y</span> <span class="o">=</span> <span class="s">&#34;Number of compositions&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">limits</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1685</span><span class="p">,</span><span class="m">1751</span><span class="p">),</span> <span class="n">breaks</span> <span class="o">=</span> <span class="nf">seq</span><span class="p">(</span><span class="m">1690</span><span class="p">,</span><span class="m">1750</span><span class="p">,</span><span class="m">10</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">scale_fill_gradient</span><span class="p">(</span><span class="n">low</span> <span class="o">=</span> <span class="n">palette[6]</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">palette[2]</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme_bach</span><span class="p">(</span><span class="n">base_family</span> <span class="o">=</span> <span class="s">&#34;Alegreya&#34;</span><span class="p">,</span> <span class="n">grid</span> <span class="o">=</span> <span class="s">&#34;y&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span>
    <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&#39;none&#39;</span>
    <span class="p">)</span>
</code></pre></div><img src="index_files/figure-gfm/BWVperyear-plot-1.png" width="1152" />
<p>It seems there were two particularly productive years. But since the
year column likely indicates year of publication, it&rsquo;s perhaps more
likely that Bach published a collection of pieces in a batch. This is
certainly true for the year 1736, when the <em>Schemellis Gesangbuch</em> came
out, a song book with sacred music, written together with a student of
the school he was cantor at: the <em>Thomasschule</em> in Leipzich. I&rsquo;ll come
back to this plot later.</p>
<p>The Wikipedia page also contained information on the key of most of the
compositions (21 were missing). I was wondering if Bach had a particular
preference for a specific key. So I calculated the number of
compositions written in each key, and separated based on the first
category.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">summ_key_cat1</span> <span class="o">&lt;-</span> <span class="n">merged_data</span> <span class="o">%&gt;%</span>
  <span class="nf">group_by</span><span class="p">(</span><span class="n">category1</span><span class="p">,</span> <span class="n">Key</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">summarise</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="nf">n</span><span class="p">())</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="nf">nchar</span><span class="p">(</span><span class="n">Key</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">1</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">Key</span> <span class="o">=</span> <span class="nf">sub</span><span class="p">(</span><span class="s">&#34;\u266D&#34;</span><span class="p">,</span> <span class="s">&#34;b&#34;</span><span class="p">,</span> <span class="n">Key</span><span class="p">),</span>
         <span class="n">Key</span> <span class="o">=</span> <span class="nf">sub</span><span class="p">(</span><span class="s">&#34;\U266F&#34;</span><span class="p">,</span> <span class="s">&#34;#&#34;</span><span class="p">,</span> <span class="n">Key</span><span class="p">),</span>
         <span class="n">Key</span> <span class="o">=</span> <span class="nf">ifelse</span><span class="p">(</span><span class="nf">nchar</span><span class="p">(</span><span class="n">Key</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">10</span><span class="p">,</span> <span class="nf">substring</span><span class="p">(</span><span class="n">Key</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="nf">nchar</span><span class="p">(</span><span class="n">Key</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="p">),</span> <span class="n">Key</span><span class="p">)</span>
  <span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">group_by</span><span class="p">(</span><span class="n">category1</span><span class="p">,</span> <span class="n">Key</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">summarise</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</code></pre></div><pre><code>`summarise()` has grouped output by 'category1'. You can override using the
`.groups` argument.
`summarise()` has grouped output by 'category1'. You can override using the
`.groups` argument.
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="nf">ggplot</span><span class="p">(</span><span class="n">summ_key_cat1</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="nf">reorder</span><span class="p">(</span><span class="n">Key</span><span class="p">,</span><span class="o">-</span><span class="n">n</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">category1</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_col</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="nf">position_dodge2</span><span class="p">(</span><span class="n">preserve</span> <span class="o">=</span> <span class="s">&#34;single&#34;</span><span class="p">,</span> <span class="n">padding</span> <span class="o">=</span> <span class="m">0</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
       <span class="n">y</span> <span class="o">=</span> <span class="s">&#34;Number of compositions&#34;</span><span class="p">,</span>
       <span class="n">fill</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_fill_daniel</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s">&#34;staalmeesters&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme_bach</span><span class="p">(</span><span class="n">base_family</span> <span class="o">=</span> <span class="s">&#34;Alegreya&#34;</span><span class="p">,</span> <span class="n">grid</span> <span class="o">=</span> <span class="s">&#34;y&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span>
    <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&#34;bottom&#34;</span><span class="p">,</span>
    <span class="n">axis.text.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="m">90</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">vjust</span> <span class="o">=</span> <span class="m">0.4</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre></div><img src="index_files/figure-gfm/colplot-key-cat1-1.png" width="768" />
<p>I noticed that there were no double keys, as in B flat is the same as A
sharp. The person who compiled the table must have taken it into account
since it&rsquo;s very unlikely that this was by chance. I also wanted to make
the same comparison for the second category. Since I didn&rsquo;t like the
idea of a large number of very skinny barplots, or the idea of a stacked
barplot, I thought the best way to go about this is to make it into a
tile plot. Since the tile plot is quite an efficient way of
disseminating information, I could also include the counts from the
primary category.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">summ_key_cat2</span> <span class="o">&lt;-</span> <span class="n">merged_data</span> <span class="o">%&gt;%</span>
  <span class="nf">group_by</span><span class="p">(</span><span class="n">category2</span><span class="p">,</span> <span class="n">Key</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">summarise</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="nf">n</span><span class="p">())</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="nf">nchar</span><span class="p">(</span><span class="n">Key</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">1</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">Key</span> <span class="o">=</span> <span class="nf">sub</span><span class="p">(</span><span class="s">&#34;\u266D&#34;</span><span class="p">,</span> <span class="s">&#34;b&#34;</span><span class="p">,</span> <span class="n">Key</span><span class="p">),</span>
         <span class="n">Key</span> <span class="o">=</span> <span class="nf">sub</span><span class="p">(</span><span class="s">&#34;\U266F&#34;</span><span class="p">,</span> <span class="s">&#34;#&#34;</span><span class="p">,</span> <span class="n">Key</span><span class="p">),</span>
         <span class="n">Key</span> <span class="o">=</span> <span class="nf">ifelse</span><span class="p">(</span><span class="nf">nchar</span><span class="p">(</span><span class="n">Key</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">10</span><span class="p">,</span> <span class="nf">substring</span><span class="p">(</span><span class="n">Key</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="nf">nchar</span><span class="p">(</span><span class="n">Key</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="p">),</span> <span class="n">Key</span><span class="p">)</span>
  <span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">group_by</span><span class="p">(</span><span class="n">category2</span><span class="p">,</span> <span class="n">Key</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">summarise</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

<span class="n">plotdat</span> <span class="o">&lt;-</span> <span class="nf">rbind</span><span class="p">(</span><span class="n">summ_key_cat1</span> <span class="o">%&gt;%</span> <span class="nf">rename</span><span class="p">(</span><span class="n">category2</span> <span class="o">=</span> <span class="n">category1</span><span class="p">),</span>
                 <span class="n">summ_key_cat2</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">cbind</span><span class="p">(</span><span class="n">gr</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="nf">nrow</span><span class="p">(</span><span class="n">summ_key_cat1</span><span class="p">)),</span>
               <span class="nf">rep</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="nf">nrow</span><span class="p">(</span><span class="n">summ_key_cat2</span><span class="p">)))</span>
        <span class="p">)</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">plotdat</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">Key</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">reorder</span><span class="p">(</span><span class="n">category2</span><span class="p">,</span><span class="n">n</span><span class="p">),</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">n</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_tile</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">geom_text</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">n</span><span class="p">),</span> <span class="n">family</span> <span class="o">=</span> <span class="s">&#34;Alegreya&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="m">8.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#FFFFF0&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
       <span class="n">y</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
       <span class="n">fill</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_x_discrete</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="s">&#34;top&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_fill_gradient</span><span class="p">(</span><span class="n">low</span> <span class="o">=</span> <span class="n">palette[6]</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">palette[2]</span><span class="p">,</span> <span class="n">breaks</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="nf">seq</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">40</span><span class="p">,</span><span class="m">10</span><span class="p">)),</span><span class="n">guide</span> <span class="o">=</span> <span class="nf">guide_colorbar</span><span class="p">(</span><span class="n">barheight</span> <span class="o">=</span> <span class="m">8</span><span class="p">,</span> <span class="n">barwidth</span> <span class="o">=</span> <span class="m">0.75</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">coord_fixed</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme_bach</span><span class="p">(</span><span class="n">base_family</span> <span class="o">=</span> <span class="s">&#34;Alegreya&#34;</span><span class="p">,</span> <span class="n">grid</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span>
    <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&#34;right&#34;</span><span class="p">,</span>
    <span class="n">axis.text.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="m">45</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">vjust</span> <span class="o">=</span> <span class="m">-0.5</span><span class="p">),</span>
    <span class="n">strip.text.x</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
    <span class="n">panel.spacing</span> <span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;lines&#34;</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre></div><p><img src="index_files/figure-gfm/tileplot-key-cat2-1.png"
width="1152" /></p>
<h2 id="places-bach-lived-and-worked">Places Bach lived and worked</h2>
<p>In addition to this, I also wanted to do some classic journalism.
Previously, I looked at Bach most productive years, but since that
seemed to be associated with year of publication rather than writing, I
thought perhaps comparing the year to the places Bach lived would be
more productive. Based on his biography, Bach had a checkered
relationship with some of the towns he lived in, either because of
personal issues, political issues with church leadership, or something
else. I looked up the places Bach lived in, and saved them in a data
frame. Using the Google Maps API, I also looked up the coordinates of
each city and calculated how long Bach lived everywhere. Bach lived in
the same city twice, these occasions I kept separate.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="nf">register_google</span><span class="p">(</span><span class="n">google_code</span><span class="p">)</span>
<span class="n">places</span> <span class="o">&lt;-</span> <span class="nf">data_frame</span><span class="p">(</span>
  <span class="n">city</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;Eisenach&#34;</span><span class="p">,</span><span class="s">&#34;Ohrdruf&#34;</span><span class="p">,</span><span class="s">&#34;Lüneburg&#34;</span><span class="p">,</span><span class="s">&#34;Weimar&#34;</span><span class="p">,</span><span class="s">&#34;Arnstadt&#34;</span><span class="p">,</span><span class="s">&#34;Mühlhausen&#34;</span><span class="p">,</span><span class="s">&#34;Weimar&#34;</span><span class="p">,</span><span class="s">&#34;Köthen&#34;</span><span class="p">,</span><span class="s">&#34;Leipzig&#34;</span><span class="p">),</span>
  <span class="n">year_from</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1685</span><span class="p">,</span><span class="m">1695</span><span class="p">,</span><span class="m">1700</span><span class="p">,</span><span class="m">1702</span><span class="p">,</span><span class="m">1703</span><span class="p">,</span><span class="m">1707</span><span class="p">,</span><span class="m">1708</span><span class="p">,</span><span class="m">1717</span><span class="p">,</span><span class="m">1723</span><span class="p">),</span>
  <span class="n">year_to</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1695</span><span class="p">,</span><span class="m">1700</span><span class="p">,</span><span class="m">1702</span><span class="p">,</span><span class="m">1703</span><span class="p">,</span><span class="m">1707</span><span class="p">,</span><span class="m">1708</span><span class="p">,</span><span class="m">1717</span><span class="p">,</span><span class="m">1723</span><span class="p">,</span><span class="m">1750</span><span class="p">)</span>
<span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate_geocode</span><span class="p">(</span><span class="n">city</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">duration</span> <span class="o">=</span> <span class="n">year_to</span> <span class="o">-</span> <span class="n">year_from</span><span class="p">)</span>
</code></pre></div><p>Since this time I wanted to visualize whether Bach was more productive
in certain places, I recreated the plot from earlier, shaded the
background with the city Bach inhabited at the time, and transformed the
bars into a density plot, which smoothed over the data and removed the
high outliers.</p>
<pre><code>`geom_smooth()` using formula 'y ~ x'

Warning: Removed 1 rows containing non-finite values (stat_smooth).
</code></pre>
<img src="index_files/figure-gfm/plot-with-city-1.png" width="1152" />
<p>It&rsquo;s obvious that Bach lived in Leipzich the longest. He had a few
productive periods, the last one perhaps being due to the publication of
the song book mentioned before.</p>
<p>Lastly, just for fun, I created a map.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">places_unique</span> <span class="o">&lt;-</span> <span class="n">places</span> <span class="o">%&gt;%</span>
  <span class="nf">distinct</span><span class="p">(</span><span class="n">.,</span> <span class="n">city</span><span class="p">,</span> <span class="n">.keep_all</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">places_unique</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">lon</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">borders</span><span class="p">(</span><span class="s">&#34;world&#34;</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="n">palette[3]</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">palette[4]</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">palette[1]</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">ggrepel</span><span class="o">::</span><span class="nf">geom_text_repel</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">city</span><span class="p">),</span> <span class="n">force</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">4</span><span class="p">,</span> 
                           <span class="n">seed</span> <span class="o">=</span> <span class="m">2345</span><span class="p">,</span> <span class="n">point.padding</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">,</span>
                           <span class="n">family</span> <span class="o">=</span> <span class="s">&#34;Alegreya&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">coord_quickmap</span><span class="p">(</span><span class="n">xlim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">18</span><span class="p">),</span> <span class="n">ylim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">48</span><span class="p">,</span> <span class="m">55</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">theme_void</span><span class="p">()</span>
</code></pre></div><img src="index_files/figure-gfm/mapplot-1.png" width="768" />
<p>This was a fun exercise in scraping data and trying out new things with
visualization!</p>
<h2 id="future-plans">Future plans</h2>
<p>In the future, I hope to do some more in-depth statistical analysis on
any of this. Perhaps I&rsquo;ll finally dive into the setting, there are some
cool more complex visualization opportunities there. With this I could
also make a Shiny app where one can select the voices you are interested
in, and it will show you the pieces that are written for that
combination of voices, or select the time of the year, and it will
return the pieces written for that part of the Christian calendar
(i.e. Advent, Epiphany, or Easter). Most importantly, I might actually
do some statistics, instead of just visualizing data. Creating nice
figures is great fun, but the real interest lies in perfoming adequate
statistical tests, though I still need to think about what statistics
would be appropriate for this context. Any tips or requests?</p>

  </article>

  <br/>

  
  
</section>

      </div>
      
        
<footer class="footer">
  <script src="https://yihui.org/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.min.js"></script>
</footer>
      
    </main>

    

  <script src="/js/app.js"></script>
  
  </body>
</html>
