<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Daniel Roelfs">
    <meta name="description" content="/">
    <meta name="keywords" content="blog,personal,coding">

    <meta property="og:site_name" content="Daniel Roelfs">
    <meta property="og:title" content="
  The Easier Way to Create a Map of Norway Using {csmaps} - Daniel Roelfs
">
    <meta property="og:description" content="The Easier Way to Create a Map of Norway Using {csmaps}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/blog/the-easier-way-to-create-a-map-of-norway-using-csmaps/">
    <meta property="og:image" content="/images/avatar.png">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="/blog/the-easier-way-to-create-a-map-of-norway-using-csmaps/">
    <meta name="twitter:image" content="/images/avatar.png">

    <base href="/blog/the-easier-way-to-create-a-map-of-norway-using-csmaps/">
    <title>
  The Easier Way to Create a Map of Norway Using {csmaps} - Daniel Roelfs
</title>

    <link rel="canonical" href="/blog/the-easier-way-to-create-a-map-of-norway-using-csmaps/">
    
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com"> 
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,wght@0,400;0,700;0,800;0,900;1,400;1,700;1,800;1,900&family=Source+Serif+4:ital,wght@0,400;0,500;0,600;0,700;0,900;1,400;1,500;1,600;1,700;1,900&display=swap" rel="stylesheet">    <link rel="stylesheet" href="/css/style.min.css">

    

    

    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

    
      <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Daniel Roelfs">
      <link href="/index.xml" rel="feed" type="application/rss+xml" title="Daniel Roelfs" />
    

    
    <script async src="https://analytics-danielroelfs.netlify.app/script.js" data-website-id="da48a88a-2e87-4024-8c99-639222aab54d"></script>
    

    <meta name="generator" content="Hugo 0.92.1" />
  </head>

  <body class="">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">Daniel Roelfs</a>
    <input type="checkbox" id="menu-control"/>
    <label class="menu-mobile  float-right " for="menu-control">
      <span class="btn-mobile  float-right ">&#9776;</span>
      <ul class="navigation-list">
        
          
            <li class="navigation-item  align-center ">
              <a class="navigation-link" href="/blog">Blog</a>
            </li>
          
            <li class="navigation-item  align-center ">
              <a class="navigation-link" href="/photography">Photography</a>
            </li>
          
            <li class="navigation-item  align-center ">
              <a class="navigation-link" href="/publications">Publications</a>
            </li>
          
            <li class="navigation-item  align-center ">
              <a class="navigation-link" href="/cv">Curriculum Vit√¶</a>
            </li>
          
            <li class="navigation-item  align-center ">
              <a class="navigation-link" href="/about">About</a>
            </li>
          
        
        
      </ul>
    </label>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
  <article>
    <header>
      <h1 class="post-title">The Easier Way to Create a Map of Norway Using {csmaps}</h1> 
      <h2 class="date">August 24, 2021</h2>

      
    </header>

    <style type="text/css">
p.announcement {
  border-radius: 5px; 
  background-color: #acc8d4; 
  padding: 1em;
}

p.announcement code {
  background-color: #93b8c8;
}
</style>
<p class="announcement">
As of March 2023 <code>{fhimaps}</code> and <code>{splmaps}</code> are no longer supported due to budget cuts at the institution supporting them. The amazing developers (led by <a href="https://www.rwhite.no">Richard Aubrey White</a> and <a href="https://andreaczhang.github.io">Chi Zhang</a>) have moved the data and functionality to a new package called <code>{csmaps}</code>. The code below is updated to reflect the changes.
</p>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
<p>Every now and then you discover a discover a much simpler solution to a problem you spent a lot of time solving. This recently happened to me on the topic of creating a map of Norway in R. In this post, I want to go through the process of what I learned.</p>
<p>Previously, I used a JSON file and the <code>{geojsonio}</code> package to create a map of Norway and its fylker (counties) in particular. This was a very flexible and robust way of going about this, but also quite cumbersome. This method relies on a high-quality JSON file, meaning, a file that is detailed enough to display everything nicely, but not too detailed that it takes a ton of time and computing power to create a single plot. While I&rsquo;ll still use this method if I need to create a map for places other than Norway, I think I&rsquo;ve found a better and easier solution for plotting Norway and the fylker and kommuner in the <a href="https://www.csids.no/csmaps/"><code>{csmaps}</code></a> package.</p>
<p>The <code>{csmaps}</code> package is created by the <em>Consortium for Statistics in Disease Surveillance</em> team. It&rsquo;s part of a series of packages (which they refer to as the &ldquo;csverse&rdquo;), which includes a package containing basic health surveillance data (<a href="https://www.csids.no/csdata/"><code>{csdata}</code></a>), one for real-time analysis in disease surveillance (<a href="https://www.csids.no/sc9/"><code>{sc9}</code></a>) and a few more. Here I&rsquo;ll dive into the <code>{csmaps}</code> package with some help from the <code>{csdata}</code> package. I&rsquo;ll also use the <code>{ggmap}</code> package to help with some other data and plotting. It&rsquo;s perhaps important to note that <code>{ggmap}</code> does contain a map of Norway as a whole, but not of the fylker and kommuner (municipalities), hence the usefulness of the <code>{csmaps}</code> package, which contains both. I&rsquo;ll also use <code>{tidyverse}</code> and <code>{ggtext}</code> as I always do. I won&rsquo;t load <code>{csmaps}</code> with the <code>library()</code> function, but will use the <code>::</code> operator instead since it&rsquo;ll make it easier to navigate the different datasets included.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">csmaps</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggtext</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggmap</span><span class="p">)</span>
</code></pre></div><p>So let&rsquo;s have a look at what&rsquo;s included. You&rsquo;ll see that nearly all maps come in either a <code>data.table</code> format or an <code>sf</code> format. Here I&rsquo;ll use only the data frames, since they&rsquo;re a lot easier to work with. The maps in <code>sf</code> format can be useful elsewhere, but I think for most purposes it&rsquo;s easier and more intuitive to work with data frames.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="nf">data</span><span class="p">(</span><span class="n">package</span> <span class="o">=</span> <span class="s">&#34;csmaps&#34;</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="nf">pluck</span><span class="p">(</span><span class="s">&#34;results&#34;</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="nf">as_tibble</span><span class="p">()</span> <span class="o">|&gt;</span> 
  <span class="nf">select</span><span class="p">(</span><span class="n">Item</span><span class="p">,</span> <span class="n">Title</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="nf">print</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">18</span><span class="p">)</span>
</code></pre></div><p>A comprehensive version of this list is also included in the <a href="https://www.csids.no/csmaps/reference/index.html">reference</a> for this package.</p>
<p>So let&rsquo;s have a look at one of those maps. For instance the one with the new fylker from 2020 with an inset of Oslo.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">map_df</span> <span class="o">&lt;-</span> <span class="n">nor_county_map_b2020_insert_oslo_dt</span> <span class="o">|&gt;</span> 
  <span class="nf">glimpse</span><span class="p">()</span>
</code></pre></div><pre><code>Rows: 4,493
Columns: 5
$ long          &lt;dbl&gt; 5.823860, 5.969413, 6.183042, 6.302433, 6.538059, 6.693511, 6.657289, 6.767480, 7.096287, 7.110080, 7.214667, 7.098724, 7.048585, 6.991842, 6.962960, 7.022880, 6.882833, 6.932169, 6.865142, 6.824533, 6.847579, 6.939172, 6.881039, 6.903689, 6.560838, 6.608553, 6.518096, 6.572750, 6.622347, 6.436069, 6.497499, 6.614721, 6.587698, 6.631556, 6.560330, 6.382453, 6.324024, 6.350390, 6.239081, 6.039468, 5.996479, 5.875390, 5.666733, 5.489157, 5.601538, 5.576495, 5.633912, 5.686111, 5.565115, 5.581353, 5.769811, 5.741457, 5.786016, 5.851127, 5.893869, 5.979000, 5.965561, 6.175315, 6.281425, 6.116682, 6.086432, 6.108257, 6.072709, 5.995039, 6.036212, 6.090791, 5.949121, 5.889756, 5.977865, 6.174015, 6.022552, 6.192079, 6.562320, 6.360672, 6.157856, 6.113738, 6.273343, 6.289766, 6.217630, 6.226502, 6.186815, 6.201218, 6.176712, 6.102012, 6.118100, 6.085544, 6.020944, 6.212991, 6.210265, 6.270777, 6.598666, 6.270651, 6.368525, 6.312591, 6.218008, 6.119585, 6.014455, 5.977‚Ä¶
$ lat           &lt;dbl&gt; 59.64576, 59.57897, 59.58607, 59.76743, 59.84285, 59.82295, 59.70174, 59.70049, 59.78278, 59.70060, 59.67269, 59.65129, 59.58683, 59.59703, 59.51645, 59.48120, 59.42930, 59.40027, 59.36840, 59.26988, 59.18267, 59.18192, 59.14459, 59.11340, 58.90995, 58.88007, 58.76741, 58.76528, 58.69668, 58.64933, 58.60992, 58.62509, 58.49277, 58.44801, 58.32740, 58.27794, 58.29827, 58.32613, 58.32347, 58.37897, 58.47691, 58.46442, 58.55017, 58.75369, 58.87953, 58.95905, 58.89528, 58.92810, 58.98060, 59.03644, 58.96494, 58.85185, 58.93869, 58.92934, 58.96797, 58.93705, 58.90389, 58.83516, 58.84096, 58.87579, 58.90089, 58.92352, 58.90352, 58.97113, 58.99728, 58.98579, 59.02345, 59.07371, 59.12151, 59.13993, 59.14356, 59.25835, 59.32107, 59.31982, 59.26062, 59.30281, 59.29761, 59.31837, 59.39100, 59.32360, 59.31884, 59.34543, 59.31699, 59.32179, 59.37375, 59.32646, 59.34218, 59.44488, 59.40925, 59.50584, 59.55886, 59.51752, 59.64394, 59.64117, 59.47384, 59.40548, 59.41009, 59.35‚Ä¶
$ order         &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217‚Ä¶
$ group         &lt;fct&gt; 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.2, 11.2, 11.2, 11.2, 11.2, 11.2, 11.2, 11.2, 11.2, 11.2, 11.2, 11.2, 11.2, 11.3, 11.3, 11.3, 11.3, 11.3, 11.3, 11.4, 11.4, 11.‚Ä¶
$ location_code &lt;chr&gt; &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;,‚Ä¶
</code></pre>
<p>Immediately you can see that there&rsquo;s a lot of rows, each representing a point on the map. A data frame with a larger number of rows would be more detailed (i.e.¬†less straight lines, more detail in curvatures of borders etc.). Let&rsquo;s create a very simple map. We&rsquo;ll use the <code>geom_polygon</code> to turn our data frame into a map. The location of the points are given in longitudes and latitudes (like x- and y-coordinates), the group serves to make sure lines are drawn correctly (try running the code below without <code>group = group</code> and see what happens). The <code>location_code</code> denotes the county number (which isn&rsquo;t from 1 to 11, but instead uses some other standard format matching numbers in other government datasets). Let&rsquo;s see the simplest map:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="nf">ggplot</span><span class="p">(</span><span class="n">map_df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">long</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">location_code</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">geom_polygon</span><span class="p">()</span>
</code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/minimal-plot-1.png" width="768" />
<p>Now let&rsquo;s convert the awkward county numbers to the actual names of the fylker. The <code>{csdata}</code> package has a data frame with codes and names for all the kommuner, fylker, and even regions (√òst, Vest, Nord-Norge etc.). We&rsquo;re only interested in the fylker here, so we&rsquo;ll select the unique location codes and the corresponding location names.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">county_names</span> <span class="o">&lt;-</span> <span class="n">csdata</span><span class="o">::</span><span class="nf">nor_locations_names</span><span class="p">(</span><span class="n">border</span> <span class="o">=</span> <span class="m">2020</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">location_code</span><span class="p">,</span> <span class="s">&#34;^county&#34;</span><span class="p">))</span> <span class="o">|&gt;</span>
  <span class="nf">distinct</span><span class="p">(</span><span class="n">location_code</span><span class="p">,</span> <span class="n">location_name</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">county_names</span><span class="p">)</span>
</code></pre></div><pre><code>    location_code        location_name
 1:  county_nor42                Agder
 2:  county_nor34            Innlandet
 3:  county_nor15      M√∏re og Romsdal
 4:  county_nor18             Nordland
 5:  county_nor03                 Oslo
 6:  county_nor11             Rogaland
 7:  county_nor54    Troms og Finnmark
 8:  county_nor50            Tr√∏ndelag
 9:  county_nor38 Vestfold og Telemark
10:  county_nor46             Vestland
11:  county_nor30                Viken
</code></pre>
<p>Now let&rsquo;s also create a nice color palette to give each fylke a nicer color than the default ggplot colors. We&rsquo;ll create a named vector to match each fylke with a color from the <em>batlow</em> palette by <a href="https://www.fabiocrameri.ch/colourmaps/">Fabio Crameri</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">county_colors</span> <span class="o">&lt;-</span> <span class="nf">setNames</span><span class="p">(</span><span class="n">scico</span><span class="o">::</span><span class="nf">scico</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="nf">nrow</span><span class="p">(</span><span class="n">county_names</span><span class="p">),</span> <span class="n">palette</span> <span class="o">=</span> <span class="s">&#34;batlow&#34;</span><span class="p">),</span>
                          <span class="n">nm</span> <span class="o">=</span> <span class="n">county_names</span><span class="o">$</span><span class="n">location_name</span><span class="p">)</span>
</code></pre></div><p>Let&rsquo;s see what we can make now. We&rsquo;ll add the county names to the large data frame containing the longitudes and latitudes and then create a plot again. I&rsquo;ll also add some other style elements, such as a labels to the x- and y-axes, circles instead of squares for the legend and a map projection. For Norway especially I think a conic map projection works well since the northern fylker are so massive and the southern fylker are more dense, so adding a conic projection with a cone tangent of 40 degrees makes it a bit more perceptionally balanced (<code>lat0</code> refers to the cone tangent, the details are complicated but a higher cone tangent results a greater distortion in favor of southern points).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">map_df</span> <span class="o">|&gt;</span> 
  <span class="nf">left_join</span><span class="p">(</span><span class="n">county_names</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s">&#34;location_code&#34;</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">long</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">location_name</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">geom_polygon</span><span class="p">(</span><span class="n">key_glyph</span> <span class="o">=</span> <span class="s">&#34;point&#34;</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
       <span class="n">y</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
       <span class="n">fill</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">label_number</span><span class="p">(</span><span class="n">suffix</span> <span class="o">=</span> <span class="s">&#34;\u00b0W&#34;</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">label_number</span><span class="p">(</span><span class="n">suffix</span> <span class="o">=</span> <span class="s">&#34;\u00b0N&#34;</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="n">county_colors</span><span class="p">,</span>
                    <span class="n">guide</span> <span class="o">=</span> <span class="nf">guide_legend</span><span class="p">(</span><span class="n">override.aes</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">shape</span> <span class="o">=</span> <span class="m">21</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">4</span><span class="p">)))</span> <span class="o">+</span>
  <span class="nf">coord_map</span><span class="p">(</span><span class="n">projection</span> <span class="o">=</span> <span class="s">&#34;conic&#34;</span><span class="p">,</span> <span class="n">lat0</span> <span class="o">=</span> <span class="m">40</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">theme_minimal</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0.9</span><span class="p">,</span><span class="m">0.2</span><span class="p">),</span>
        <span class="n">legend.text</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">5</span><span class="p">),</span>
        <span class="n">legend.key.height</span> <span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="s">&#34;pt&#34;</span><span class="p">),</span>
        <span class="n">legend.background</span> <span class="o">=</span> <span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;transparent&#34;</span><span class="p">))</span>
</code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/simple-plot-1.png" width="768" />
<h2 id="norway-with-scandinavia">Norway with Scandinavia</h2>
<p>Sometimes it&rsquo;s useful to plot Norway in geographical context. We can overlay Norway on a map of Scandinavia or Europe to create a more aesthetically pleasing figure that is less scientific but easier to read. For that we&rsquo;ll first extract the longitude and latitude extremities of Norway, so we can easily center Norway on our new map.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="nf">str_glue</span><span class="p">(</span><span class="s">&#34;Range across longitude: {str_c(range(map_df$long), collapse = &#39;, &#39;)}&#34;</span><span class="p">)</span>
<span class="nf">str_glue</span><span class="p">(</span><span class="s">&#34;Range across latitude: {str_c(range(map_df$lat), collapse = &#39;, &#39;)}&#34;</span><span class="p">)</span>
</code></pre></div><pre><code>Range across longitude: 4.64197936086325, 31.0578692314387
Range across latitude: 57.9797576545731, 71.1848833506563
</code></pre>
<p>Let&rsquo;s also combine the map with some actual data. The <code>{csdata}</code> package contains some simple data on age distribution in kommuner and fylker. Let&rsquo;s take the data from the different fylker in the last available year and see what proportion of the total population is younger than 18.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">age_data</span> <span class="o">&lt;-</span> <span class="n">csdata</span><span class="o">::</span><span class="nf">nor_population_by_age_cats</span><span class="p">(</span><span class="n">border</span> <span class="o">=</span> <span class="m">2020</span><span class="p">,</span> <span class="n">cats</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">18</span><span class="p">)))</span> <span class="o">|&gt;</span>
  <span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">location_code</span><span class="p">,</span> <span class="s">&#34;^county&#34;</span><span class="p">),</span> 
         <span class="n">calyear</span> <span class="o">==</span> <span class="nf">max</span><span class="p">(</span><span class="n">calyear</span><span class="p">))</span> <span class="o">|&gt;</span>
  <span class="nf">pivot_wider</span><span class="p">(</span><span class="n">id_cols</span> <span class="o">=</span> <span class="n">location_code</span><span class="p">,</span> <span class="n">names_from</span> <span class="o">=</span> <span class="n">age</span><span class="p">,</span> <span class="n">values_from</span> <span class="o">=</span> <span class="n">pop_jan1_n</span><span class="p">)</span> <span class="o">|&gt;</span>
  <span class="n">janitor</span><span class="o">::</span><span class="nf">clean_names</span><span class="p">()</span> <span class="o">|&gt;</span>
  <span class="nf">rename</span><span class="p">(</span><span class="n">age_0_18</span> <span class="o">=</span> <span class="n">x000_018</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="nf">mutate</span><span class="p">(</span><span class="n">proportion</span> <span class="o">=</span> <span class="n">age_0_18</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span>
</code></pre></div><p>Let&rsquo;s create a map without the Oslo inset, combine it with the age distribution data and plot it on top of a map of the world cropped to just Scandinavia. So for this we load another data frame and use <code>left_join</code> to merge the age distribution data into one data frame. The <code>{ggmap}</code> package has a map of the entire world, which we&rsquo;ll use. To avoid awkward overlap, we&rsquo;ll plot everything except Norway from that world map (since we&rsquo;ll have our own better map to use instead). We&rsquo;ll set the <code>fill</code> to proportion of the population under the age of 18 and set similar style elements to make the figure look nicer. I used the extremities we extracted earlier as a guideline, but we can play around with the crop of the map to get something that works best.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">nor_county_map_b2020_default_dt</span> <span class="o">|&gt;</span>
  <span class="nf">left_join</span><span class="p">(</span><span class="n">age_data</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s">&#34;location_code&#34;</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">long</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_polygon</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="nf">map_data</span><span class="p">(</span><span class="s">&#34;world&#34;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nf">filter</span><span class="p">(</span><span class="n">region</span> <span class="o">!=</span> <span class="s">&#34;Norway&#34;</span><span class="p">),</span> 
               <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;grey80&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_polygon</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="n">proportion</span><span class="p">),</span> <span class="n">key_glyph</span> <span class="o">=</span> <span class="s">&#34;point&#34;</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">labs</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;Proportion of the population younger than 18&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">scico</span><span class="o">::</span><span class="nf">scale_fill_scico</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s">&#34;devon&#34;</span><span class="p">,</span> <span class="n">limits</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0.15</span><span class="p">,</span> <span class="m">0.31</span><span class="p">),</span> 
                          <span class="n">labels</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">percent_format</span><span class="p">(</span><span class="n">accuracy</span> <span class="o">=</span> <span class="m">1</span><span class="p">),</span>
                          <span class="n">guide</span> <span class="o">=</span> <span class="nf">guide_colorbar</span><span class="p">(</span><span class="n">title.position</span> <span class="o">=</span> <span class="s">&#34;top&#34;</span><span class="p">,</span> <span class="n">title.hjust</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span>
                                                 <span class="n">barwidth</span> <span class="o">=</span> <span class="m">10</span><span class="p">,</span> <span class="n">barheight</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">ticks</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">coord_map</span><span class="p">(</span><span class="n">projection</span> <span class="o">=</span> <span class="s">&#34;conic&#34;</span><span class="p">,</span> <span class="n">lat0</span> <span class="o">=</span> <span class="m">60</span><span class="p">,</span> 
            <span class="n">xlim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">-8</span><span class="p">,</span><span class="m">40</span><span class="p">),</span> <span class="n">ylim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">57</span><span class="p">,</span> <span class="m">70</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">theme_void</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">plot.background</span> <span class="o">=</span> <span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#A2C0F4&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;transparent&#34;</span><span class="p">),</span>
        <span class="n">legend.direction</span> <span class="o">=</span> <span class="s">&#34;horizontal&#34;</span><span class="p">,</span>
        <span class="n">legend.position</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0.8</span><span class="p">,</span> <span class="m">0.1</span><span class="p">),</span>
        <span class="n">legend.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">),</span>
        <span class="n">legend.text</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">6</span><span class="p">))</span>
</code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/age-plot-1.png" width="768" />
<h2 id="geocoding">Geocoding</h2>
<p>The <code>{ggmap}</code> package also has an incredibly useful function called <code>mutate_geocode()</code> which transforms a string with an address or description in character format to longitude and latitude. Since <code>{ggmap}</code> uses the Google Maps API, it works similarly to typing in a description in Google Maps. So an approximation of the location will (most likely) get you the right result (e.g.¬†with &ldquo;Hospital Lillehammer&rdquo;). Note that <code>mutate_geocode</code> uses <code>lon</code> instead of <code>long</code> as column name for longitude. Just to avoid confusion, I&rsquo;ll rename the column to <code>long</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">hospitals_df</span> <span class="o">&lt;-</span> <span class="nf">tibble</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;Ullev√•l Sykehus, Oslo&#34;</span><span class="p">,</span><span class="s">&#34;Haukeland universitetssjukehus, Bergen&#34;</span><span class="p">,</span><span class="s">&#34;St. Olav, Trondheim&#34;</span><span class="p">,</span>
                                    <span class="s">&#34;Universitetssykehuset Nord-Norge, Troms√∏&#34;</span><span class="p">,</span><span class="s">&#34;Stavanger Universitetssjukehus&#34;</span><span class="p">,</span><span class="s">&#34;S√∏rlandet Hospital Kristiansand&#34;</span><span class="p">,</span> <span class="s">&#34;Hospital Lillehammer&#34;</span><span class="p">))</span> <span class="o">|&gt;</span> 
  <span class="nf">mutate_geocode</span><span class="p">(</span><span class="n">location</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="nf">rename</span><span class="p">(</span><span class="n">long</span> <span class="o">=</span> <span class="n">lon</span><span class="p">)</span>
</code></pre></div><p>This is the list of coordinates it gave us:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="nf">print</span><span class="p">(</span><span class="n">hospitals_df</span><span class="p">)</span>
</code></pre></div><pre><code># A tibble: 7 √ó 3
  location                                  long   lat
  &lt;chr&gt;                                    &lt;dbl&gt; &lt;dbl&gt;
1 Ullev√•l Sykehus, Oslo                    10.7   59.9
2 Haukeland universitetssjukehus, Bergen    5.36  60.4
3 St. Olav, Trondheim                      10.4   63.4
4 Universitetssykehuset Nord-Norge, Troms√∏ 19.0   69.7
5 Stavanger Universitetssjukehus            5.73  59.0
6 S√∏rlandet Hospital Kristiansand           7.98  58.2
7 Hospital Lillehammer                     10.5   61.1
</code></pre>
<p>Now let&rsquo;s put these on top of the map. We&rsquo;ll use the same map we used earlier. We&rsquo;ll add the locations using a simple <code>geom_point</code>. This time I&rsquo;ll also add a line from the inset to Oslo&rsquo;s location on the map. The <code>xend</code> and <code>yend</code> coordinates takes some trial-and-error but I think it&rsquo;s worth it. I&rsquo;ll also add labels to each of the points with the help of the <code>{ggrepel}</code> package to illustrate what the points stand for. I suppose usually this is obvious from context, but I just wanted to show how it can be done anyway.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="nf">set.seed</span><span class="p">(</span><span class="m">21</span><span class="p">)</span>

<span class="n">map_df</span> <span class="o">|&gt;</span> 
  <span class="nf">left_join</span><span class="p">(</span><span class="n">county_names</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s">&#34;location_code&#34;</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">long</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">location_name</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">geom_polygon</span><span class="p">(</span><span class="n">key_glyph</span> <span class="o">=</span> <span class="s">&#34;point&#34;</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">geom_segment</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">hospitals_df</span> <span class="o">|&gt;</span> <span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="s">&#34;Oslo&#34;</span><span class="p">)),</span> 
               <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">long</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">xend</span> <span class="o">=</span> <span class="m">19.5</span><span class="p">,</span> <span class="n">yend</span> <span class="o">=</span> <span class="m">62</span><span class="p">),</span> <span class="n">inherit.aes</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">hospitals_df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">long</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">),</span> <span class="n">inherit.aes</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
             <span class="n">shape</span> <span class="o">=</span> <span class="m">18</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;firebrick&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">4</span><span class="p">,</span> <span class="n">show.legend</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">ggrepel</span><span class="o">::</span><span class="nf">geom_label_repel</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">hospitals_df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">long</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">location</span><span class="p">),</span>
                            <span class="n">size</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.75</span><span class="p">,</span> <span class="n">label.size</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">inherit.aes</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
       <span class="n">y</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
       <span class="n">fill</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="n">county_colors</span><span class="p">,</span>
                    <span class="n">guide</span> <span class="o">=</span> <span class="nf">guide_legend</span><span class="p">(</span><span class="n">override.aes</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">4</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="m">21</span><span class="p">,</span> 
                                                             <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;transparent&#34;</span><span class="p">)))</span> <span class="o">+</span>
  <span class="nf">coord_map</span><span class="p">(</span><span class="n">projection</span> <span class="o">=</span> <span class="s">&#34;conic&#34;</span><span class="p">,</span> <span class="n">lat0</span> <span class="o">=</span> <span class="m">60</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">theme_void</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.7</span><span class="p">),</span>
        <span class="n">legend.text</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">5</span><span class="p">),</span>
        <span class="n">legend.key.height</span> <span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="s">&#34;pt&#34;</span><span class="p">))</span>
</code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/plot-w-cities-1.png" width="768" />
<h2 id="combine-the-map-with-other-data">Combine the map with other data</h2>
<p>Let&rsquo;s take it a step further and now look at how we can combine our map with data that didn&rsquo;t come directly from the FHI. Instead I downloaded some data from the Norwegian Statistics Bureau (<a href="https://www.ssb.no">Statistisk sentralbyr√•, SSB</a>) on land use in the kommuner (<a href="https://www.ssb.no/en/natur-og-miljo/areal/statistikk/arealbruk-og-arealressurser">link</a>). This came in the form of a semi-colon separated .csv file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">area_use</span> <span class="o">&lt;-</span> <span class="nf">read_delim</span><span class="p">(</span><span class="s">&#34;areal.csv&#34;</span><span class="p">,</span> <span class="n">delim</span> <span class="o">=</span> <span class="s">&#34;;&#34;</span><span class="p">,</span> <span class="n">skip</span> <span class="o">=</span> <span class="m">2</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="n">janitor</span><span class="o">::</span><span class="nf">clean_names</span><span class="p">()</span>

<span class="nf">print</span><span class="p">(</span><span class="n">area_use</span><span class="p">)</span>
</code></pre></div><pre><code># A tibble: 356 √ó 20
   region           area_2021_residential_areas area_2021_recreational_facilities area_2021_built_up_areas_for_agriculture_and_fishing area_2021_industrial_commercial_and_service_areas area_2021_education_and_day_care_facilities area_2021_health_and_social_welfare_institutions area_2021_cultural_and_religious_activities area_2021_transport_telecommunications_and_technical_infrastructure area_2021_emergency_and_defence_services area_2021_green_areas_and_sports_facilities area_2021_unclassified_built_up_areas_and_related_land area_2021_agricultural_land area_2021_forest area_2021_open_firm_ground area_2021_wetland area_2021_bare_rock_gravel_and_blockfields area_2021_permanent_snow_and_glaciers area_2021_inland_waters area_2021_unclassified_undeveloped_areas
   &lt;chr&gt;                                  &lt;dbl&gt;                             &lt;dbl&gt;                                                &lt;dbl&gt;                                             &lt;dbl&gt;                                       &lt;dbl&gt;                                            &lt;dbl&gt;                                       &lt;dbl&gt;                                                               &lt;dbl&gt;                                    &lt;dbl&gt;                                       &lt;dbl&gt;                                                  &lt;dbl&gt;                       &lt;dbl&gt;            &lt;dbl&gt;                      &lt;dbl&gt;             &lt;dbl&gt;                                      &lt;dbl&gt;                                 &lt;dbl&gt;                   &lt;dbl&gt;                                    &lt;dbl&gt;
 1 3001 Halden                             9.61                              1.85                                                 2.51                                              2.89                                        0.29                                             0.21                                        0.22                                                               11.4                                      0.03                                        0.84                                                   1.51                       61.6             480.                        2.88             16.2                                        1.3                                      0                   48.7                                         0
 2 3002 Moss                              10.4                               1.86                                                 1.59                                              3.92                                        0.32                                             0.21                                        0.14                                                                7.7                                      0.26                                        1.57                                                   1.42                       33.6              60.0                       4.09              0.21                                       0.48                                     0                   10.1                                         0
 3 3003 Sarpsborg                         14.0                               2.95                                                 3.49                                              4.39                                        0.48                                             0.28                                        0.19                                                               12.2                                      0.01                                        1.87                                                   1.52                       78.1             241.                        8.22              1.7                                        1.55                                     0                   33.5                                         0
 4 3004 Fredrikstad                       19.9                               5.14                                                 3.05                                              6.24                                        0.62                                             0.36                                        0.26                                                               11.8                                      0.27                                        2.84                                                   2.49                       67.4             139.                        8.91              0.23                                      15.4                                      0                    8.59                                        0
 5 3005 Drammen                           18.4                               1.17                                                 1.26                                              4.59                                        0.63                                             0.35                                        0.23                                                               11.6                                      0.01                                        3.41                                                   2.54                       26.0             226.                        2.59              5                                          1.17                                     0                   13.2                                         0
 6 3006 Kongsberg                          7.68                              2.23                                                 2.38                                              2.23                                        0.36                                             0.11                                        0.15                                                               11.8                                      0.35                                        1.86                                                   1.4                        40.2             616.                       15.4              32.1                                       18.8                                      0                   39.6                                         0
 7 3007 Ringerike                         11                                 3.99                                                 4.18                                              5.19                                        0.37                                             0.29                                        0.11                                                               21.4                                      0.36                                        1.27                                                   2.12                       77.7            1191.                       47.9              50.8                                        3.21                                     0                  134.                                          0
 8 3011 Hvaler                             2.31                              5.79                                                 0.65                                              0.34                                        0.04                                             0.02                                        0.03                                                                1.96                                     0                                           0.29                                                   0.19                        4.76             34.0                       5.65              0.16                                      33.5                                      0                    0.21                                        0
 9 3012 Aremark                            0.64                              0.73                                                 0.8                                               0.31                                        0.02                                             0.01                                        0.03                                                                3.35                                     0                                           0.16                                                   0.14                       20.9             245.                        0.94              7.24                                       0.02                                     0                   38.6                                         0
10 3013 Marker                             1.38                              0.58                                                 1.68                                              0.52                                        0.03                                             0.02                                        0.05                                                                5.38                                     0.01                                        0.14                                                   0.34                       40.0             305.                        1.71             10.5                                        0.04                                     0                   46.0                                         0
# ‚Ñπ 346 more rows
</code></pre>
<p>You can see there&rsquo;s 356 rows, each representing a different kommune in Norway. The columns here represent the surface area (in km<sup>2</sup>) with different designations (e.g.¬†forest, health services, agriculture etc.). All data here is from 2021. Now, kommunes have different sizes, so I want to get the designations of interest as percentages of total area in the kommune. Here I assumed that the sum of all designations is equal to the total size of each kommune. I also want to extract the kommune number, since we&rsquo;ll use that to merge this data frame with the map later. The kommune number needs to be 4 digits, so we need to add a leading 0 in some instances. Then we&rsquo;ll create the <code>location_code</code> column which will match the <code>location_code</code> column in the data frame from <code>{csmaps}</code>. Then we&rsquo;ll calculate the percentage land use for different designations. Here I&rsquo;m just interested in <em>&ldquo;bare rock, gravel, and blockfields&rdquo;</em>, <em>&ldquo;wetland</em>, <em>&ldquo;forest&rdquo;</em>, and <em>&ldquo;Open firm ground&rdquo;</em>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">area_use</span> <span class="o">&lt;-</span> <span class="n">area_use</span> <span class="o">|&gt;</span> 
  <span class="nf">mutate</span><span class="p">(</span><span class="n">total_area</span> <span class="o">=</span> <span class="nf">rowSums</span><span class="p">(</span><span class="nf">across</span><span class="p">(</span><span class="nf">where</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">))),</span>
         <span class="n">kommune_code</span> <span class="o">=</span> <span class="nf">parse_number</span><span class="p">(</span><span class="n">region</span><span class="p">),</span>
         <span class="n">kommune_code</span> <span class="o">=</span> <span class="nf">format</span><span class="p">(</span><span class="n">kommune_code</span><span class="p">,</span> <span class="n">digits</span> <span class="o">=</span> <span class="m">4</span><span class="p">),</span>
         <span class="n">kommune_code</span> <span class="o">=</span> <span class="nf">str_replace_all</span><span class="p">(</span><span class="n">kommune_code</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">,</span> <span class="s">&#34;0&#34;</span><span class="p">),</span>
         <span class="n">location_code</span> <span class="o">=</span> <span class="nf">str_glue</span><span class="p">(</span><span class="s">&#34;municip_nor{kommune_code}&#34;</span><span class="p">),</span>
         <span class="n">perc_rocks</span> <span class="o">=</span> <span class="n">area_2021_bare_rock_gravel_and_blockfields</span> <span class="o">/</span> <span class="n">total_area</span><span class="p">,</span>
         <span class="n">perc_wetland</span> <span class="o">=</span> <span class="n">area_2021_wetland</span> <span class="o">/</span> <span class="n">total_area</span><span class="p">,</span>
         <span class="n">perc_forest</span> <span class="o">=</span> <span class="n">area_2021_forest</span> <span class="o">/</span> <span class="n">total_area</span><span class="p">,</span>
         <span class="n">perc_open_ground</span> <span class="o">=</span> <span class="n">area_2021_open_firm_ground</span> <span class="o">/</span> <span class="n">total_area</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="nf">arrange</span><span class="p">(</span><span class="n">kommune_code</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="nf">glimpse</span><span class="p">()</span>
</code></pre></div><pre><code>Rows: 356
Columns: 27
$ region                                                              &lt;chr&gt; &quot;0301 Oslo municipality&quot;, &quot;1101 Eigersund&quot;, &quot;1103 Stavanger&quot;, &quot;1106 Haugesund&quot;, &quot;1108 Sandnes&quot;, &quot;1111 Sokndal&quot;, &quot;1112 Lund&quot;, &quot;1114 Bjerkreim&quot;, &quot;1119 H\xe5&quot;, &quot;1120 Klepp&quot;, &quot;1121 Time&quot;, &quot;1122 Gjesdal&quot;, &quot;1124 Sola&quot;, &quot;1127 Randaberg&quot;, &quot;1130 Strand&quot;, &quot;1133 Hjelmeland&quot;, &quot;1134 Suldal&quot;, &quot;1135 Sauda&quot;, &quot;1144 Kvits\xf8y&quot;, &quot;1145 Bokn&quot;, &quot;1146 Tysv\xe6r&quot;, &quot;1149 Karm\xf8y&quot;, &quot;1151 Utsira&quot;, &quot;1160 Vindafjord&quot;, &quot;1505 Kristiansund&quot;, &quot;1506 Molde&quot;, &quot;1507 \xc5lesund&quot;, &quot;1511 Vanylven&quot;, &quot;1514 Sande (M\xf8re og Romsdal)&quot;, &quot;1515 Her\xf8y (M\xf8re og Romsdal)&quot;, &quot;1516 Ulstein&quot;, &quot;1517 Hareid&quot;, &quot;1520 \xd8rsta&quot;, &quot;1525 Stranda&quot;, &quot;1528 Sykkylven&quot;, &quot;1531 Sula&quot;, &quot;1532 Giske&quot;, &quot;1535 Vestnes&quot;, &quot;1539 Rauma&quot;, &quot;1547 Aukra&quot;, &quot;1554 Aver\xf8y&quot;, &quot;1557 Gjemnes&quot;, &quot;1560 Tingvoll&quot;, &quot;1563 Sunndal&quot;, &quot;1566 Surnadal&quot;, &quot;1573 Sm\xf8la&quot;, &quot;1576 Aure&quot;, &quot;1577 Volda&quot;, &quot;1578 Fjord&quot;, &quot;1579 Hustadvika&quot;, &quot;1804 Bod\xf8&quot;, &quot;1806 Narvik&quot;, &quot;1811 Bindal&quot;, &quot;1812 S\xf8mna&quot;, &quot;181‚Ä¶
$ area_2021_residential_areas                                         &lt;dbl&gt; 51.53, 3.58, 19.28, 7.30, 11.90, 1.15, 1.03, 0.70, 3.66, 3.45, 3.49, 2.23, 4.70, 1.71, 3.75, 0.81, 1.25, 1.54, 0.12, 0.34, 3.48, 12.53, 0.07, 2.98, 4.78, 7.88, 15.66, 1.22, 0.82, 3.00, 2.17, 1.50, 2.92, 1.30, 2.15, 2.69, 2.29, 2.86, 1.96, 1.86, 2.26, 0.83, 1.37, 2.07, 2.11, 0.88, 1.28, 2.53, 0.75, 4.79, 8.31, 5.79, 0.56, 0.65, 2.56, 0.63, 0.20, 0.86, 2.10, 0.85, 3.50, 0.56, 0.57, 0.71, 0.76, 1.69, 7.11, 0.88, 0.19, 0.63, 2.97, 1.04, 0.47, 1.82, 3.82, 0.75, 1.02, 0.77, 0.58, 0.25, 0.29, 0.64, 5.09, 2.41, 2.97, 1.29, 1.85, 3.32, 2.06, 0.45, 1.38, 9.61, 10.41, 13.98, 19.91, 18.35, 7.68, 11.00, 2.31, 0.64, 1.38, 13.26, 1.31, 2.95, 2.67, 1.93, 4.30, 11.79, 4.68, 3.60, 5.70, 22.83, 25.10, 7.36, 3.31, 3.23, 5.76, 15.38, 5.24, 1.92, 7.53, 7.49, 8.37, 4.31, 1.38, 2.35, 0.56, 1.50, 1.81, 0.83, 1.66, 1.98, 1.42, 1.09, 5.35, 6.29, 6.06, 1.11, 0.50, 0.95, 2.39, 3.30, 6.35, 7.93, 7.19, 10.47, 13.54, 3.07, 8.24, 2.52, 3.89‚Ä¶
$ area_2021_recreational_facilities                                   &lt;dbl&gt; 1.12, 1.20, 1.87, 0.21, 2.85, 0.26, 0.50, 0.67, 0.43, 0.13, 0.04, 0.66, 0.30, 0.14, 1.61, 1.02, 1.64, 0.92, 0.07, 0.18, 1.74, 0.80, 0.05, 1.31, 0.47, 1.62, 1.83, 0.31, 0.17, 0.35, 0.22, 0.13, 0.64, 0.72, 0.68, 0.15, 0.10, 0.63, 1.09, 0.11, 0.52, 0.67, 1.16, 0.67, 1.43, 0.50, 1.39, 0.63, 0.76, 0.80, 2.53, 3.45, 0.42, 0.28, 0.79, 0.44, 0.18, 0.58, 0.50, 0.50, 0.81, 0.71, 0.64, 0.38, 0.39, 0.93, 1.60, 0.85, 0.05, 0.55, 0.83, 1.76, 0.59, 1.06, 1.03, 0.61, 0.90, 0.59, 0.61, 0.05, 0.06, 0.15, 0.81, 0.67, 0.68, 0.75, 0.42, 0.66, 0.50, 0.10, 1.37, 1.85, 1.86, 2.95, 5.14, 1.17, 2.23, 3.99, 5.79, 0.73, 0.58, 1.42, 0.41, 0.29, 1.19, 0.42, 2.02, 0.52, 0.57, 4.12, 1.68, 0.83, 4.51, 1.47, 0.13, 1.02, 0.02, 0.69, 0.53, 0.06, 0.10, 0.66, 0.67, 0.30, 0.69, 1.00, 2.64, 3.65, 3.06, 2.30, 3.08, 7.11, 4.51, 1.56, 0.57, 0.53, 0.32, 3.26, 2.13, 3.73, 0.31, 1.26, 1.46, 0.74, 1.62, 0.86, 7.62, 1.36, 0.90, 0.86, 0.65, 0.82, 0.84, 0.7‚Ä¶
$ area_2021_built_up_areas_for_agriculture_and_fishing                &lt;dbl&gt; 0.64, 1.26, 3.51, 0.33, 3.58, 0.54, 0.89, 1.22, 4.21, 4.36, 2.28, 1.03, 1.91, 1.07, 1.29, 1.41, 1.48, 0.39, 0.09, 0.27, 2.25, 2.12, 0.03, 3.02, 0.30, 3.22, 3.33, 1.26, 0.57, 0.78, 0.39, 0.60, 2.15, 0.93, 1.04, 0.29, 0.82, 1.51, 1.78, 0.33, 1.32, 1.27, 1.14, 1.28, 1.96, 0.81, 1.37, 2.14, 1.02, 3.73, 1.65, 1.21, 0.71, 0.89, 1.13, 0.42, 0.26, 0.18, 0.70, 1.00, 1.68, 0.49, 0.74, 0.62, 0.37, 1.27, 1.53, 0.26, 0.03, 0.25, 0.76, 0.33, 0.55, 1.26, 0.75, 0.62, 1.04, 0.29, 0.49, 0.07, 0.15, 0.24, 0.78, 0.67, 1.14, 0.32, 0.36, 1.35, 1.03, 0.12, 0.75, 2.51, 1.59, 3.49, 3.05, 1.26, 2.38, 4.18, 0.65, 0.80, 1.68, 8.58, 1.33, 3.52, 1.62, 1.41, 1.35, 1.49, 1.38, 0.73, 0.49, 1.09, 2.42, 3.81, 0.16, 1.08, 0.30, 4.10, 0.81, 0.60, 2.66, 4.79, 2.72, 1.97, 0.63, 1.01, 0.63, 1.34, 1.75, 0.84, 2.15, 1.15, 2.14, 0.81, 2.82, 2.39, 2.67, 1.53, 1.12, 1.44, 0.81, 1.53, 3.41, 1.95, 2.40, 3.56, 7.60, 2.30, 3.70, 2.11, 2.62, 2.44, 2.84, 4.2‚Ä¶
$ area_2021_industrial_commercial_and_service_areas                   &lt;dbl&gt; 10.37, 2.09, 4.86, 1.71, 5.89, 4.44, 0.24, 0.49, 1.75, 1.79, 1.39, 1.71, 2.97, 0.49, 1.93, 1.22, 1.78, 0.79, 0.02, 0.10, 3.02, 3.96, 0.01, 1.51, 2.06, 3.37, 4.50, 1.97, 0.33, 0.77, 0.85, 0.50, 1.38, 0.75, 0.90, 0.48, 0.51, 1.34, 1.58, 1.58, 1.12, 0.28, 0.46, 1.81, 1.15, 0.31, 1.23, 0.95, 0.85, 2.95, 2.88, 3.71, 0.24, 0.21, 1.91, 0.19, 0.08, 0.21, 1.57, 0.35, 2.27, 0.43, 0.46, 0.11, 0.45, 0.85, 9.87, 0.28, 0.07, 0.16, 1.17, 0.76, 0.16, 0.97, 1.24, 0.79, 0.29, 0.43, 0.23, 0.11, 0.15, 0.26, 1.29, 1.08, 0.76, 0.50, 0.52, 1.41, 1.21, 0.12, 0.51, 2.89, 3.92, 4.39, 6.24, 4.59, 2.23, 5.19, 0.34, 0.31, 0.52, 4.45, 0.33, 1.23, 1.28, 0.29, 2.61, 2.58, 1.38, 0.42, 0.53, 3.41, 4.44, 1.91, 0.19, 0.97, 1.51, 6.03, 1.57, 0.16, 5.18, 1.46, 1.78, 0.75, 0.27, 0.51, 0.39, 0.77, 1.03, 0.99, 1.26, 1.26, 0.94, 0.58, 1.77, 2.48, 3.10, 0.97, 0.43, 0.79, 0.69, 0.60, 2.23, 2.57, 2.28, 3.19, 3.99, 0.54, 1.60, 0.57, 1.20, 0.94, 1.08, 1.‚Ä¶
$ area_2021_education_and_day_care_facilities                         &lt;dbl&gt; 3.51, 0.17, 1.27, 0.37, 0.69, 0.02, 0.06, 0.04, 0.22, 0.23, 0.22, 0.14, 0.30, 0.14, 0.16, 0.06, 0.07, 0.06, 0.00, 0.02, 0.13, 0.45, 0.00, 0.12, 0.21, 0.40, 0.80, 0.05, 0.03, 0.11, 0.07, 0.03, 0.12, 0.06, 0.08, 0.10, 0.11, 0.12, 0.07, 0.09, 0.06, 0.06, 0.04, 0.10, 0.09, 0.04, 0.04, 0.17, 0.03, 0.19, 0.49, 0.26, 0.04, 0.02, 0.08, 0.02, 0.01, 0.01, 0.09, 0.03, 0.15, 0.02, 0.03, 0.02, 0.05, 0.06, 0.24, 0.04, 0.01, 0.04, 0.11, 0.05, 0.02, 0.06, 0.15, 0.03, 0.04, 0.03, 0.02, 0.01, 0.01, 0.04, 0.18, 0.11, 0.10, 0.03, 0.04, 0.12, 0.08, 0.01, 0.05, 0.29, 0.32, 0.48, 0.62, 0.63, 0.36, 0.37, 0.04, 0.02, 0.03, 0.45, 0.04, 0.09, 0.09, 0.06, 0.19, 0.47, 0.54, 0.11, 0.17, 1.08, 0.90, 0.18, 0.14, 0.10, 0.33, 0.72, 0.25, 0.06, 0.41, 0.28, 0.26, 0.15, 0.06, 0.11, 0.01, 0.03, 0.08, 0.02, 0.13, 0.07, 0.04, 0.03, 0.19, 0.16, 0.21, 0.05, 0.02, 0.03, 0.06, 0.12, 0.21, 0.33, 0.29, 0.33, 0.41, 0.09, 0.28, 0.05, 0.14, 0.08, 0.05, 0.1‚Ä¶
$ area_2021_health_and_social_welfare_institutions                    &lt;dbl&gt; 1.17, 0.04, 0.47, 0.14, 0.19, 0.01, 0.02, 0.00, 0.16, 0.07, 0.05, 0.02, 0.07, 0.02, 0.03, 0.02, 0.04, 0.03, 0.00, 0.00, 0.05, 0.16, 0.00, 0.06, 0.08, 0.15, 0.31, 0.03, 0.01, 0.05, 0.04, 0.02, 0.04, 0.02, 0.02, 0.03, 0.02, 0.07, 0.03, 0.05, 0.03, 0.02, 0.02, 0.04, 0.04, 0.02, 0.04, 0.07, 0.04, 0.08, 0.18, 0.10, 0.02, 0.02, 0.03, 0.01, 0.01, 0.01, 0.03, 0.02, 0.07, 0.00, 0.02, 0.01, 0.01, 0.02, 0.14, 0.03, 0.01, 0.01, 0.05, 0.02, 0.01, 0.05, 0.07, 0.03, 0.02, 0.03, 0.01, 0.00, 0.01, 0.01, 0.05, 0.04, 0.06, 0.02, 0.03, 0.06, 0.03, 0.01, 0.02, 0.21, 0.21, 0.28, 0.36, 0.35, 0.11, 0.29, 0.02, 0.01, 0.02, 0.23, 0.03, 0.04, 0.03, 0.03, 0.06, 0.16, 0.09, 0.04, 0.08, 0.38, 0.43, 0.08, 0.03, 0.03, 0.20, 0.25, 0.05, 0.01, 0.21, 0.07, 0.12, 0.04, 0.04, 0.06, 0.02, 0.03, 0.02, 0.01, 0.04, 0.03, 0.01, 0.02, 0.14, 0.09, 0.07, 0.01, 0.02, 0.02, 0.02, 0.07, 0.16, 0.15, 0.10, 0.17, 0.23, 0.04, 0.23, 0.07, 0.03, 0.04, 0.06, 0.0‚Ä¶
$ area_2021_cultural_and_religious_activities                         &lt;dbl&gt; 0.90, 0.06, 0.36, 0.11, 0.22, 0.03, 0.04, 0.02, 0.10, 0.07, 0.06, 0.10, 0.09, 0.04, 0.07, 0.03, 0.05, 0.02, 0.00, 0.01, 0.08, 0.25, 0.00, 0.07, 0.07, 0.18, 0.26, 0.04, 0.03, 0.07, 0.02, 0.02, 0.06, 0.03, 0.03, 0.03, 0.04, 0.05, 0.05, 0.03, 0.06, 0.04, 0.04, 0.05, 0.05, 0.05, 0.03, 0.05, 0.04, 0.12, 0.17, 0.15, 0.02, 0.03, 0.07, 0.03, 0.01, 0.02, 0.05, 0.02, 0.07, 0.01, 0.03, 0.03, 0.03, 0.05, 0.14, 0.04, 0.01, 0.03, 0.07, 0.05, 0.03, 0.04, 0.03, 0.02, 0.04, 0.02, 0.03, 0.00, 0.01, 0.01, 0.11, 0.08, 0.07, 0.03, 0.04, 0.05, 0.08, 0.02, 0.07, 0.22, 0.14, 0.19, 0.26, 0.23, 0.15, 0.11, 0.03, 0.03, 0.05, 0.22, 0.02, 0.07, 0.03, 0.02, 0.03, 0.10, 0.06, 0.05, 0.06, 0.18, 0.20, 0.08, 0.03, 0.03, 0.05, 0.19, 0.05, 0.02, 0.09, 0.07, 0.10, 0.04, 0.04, 0.02, 0.02, 0.05, 0.03, 0.02, 0.06, 0.07, 0.03, 0.02, 0.07, 0.10, 0.06, 0.03, 0.03, 0.03, 0.05, 0.03, 0.10, 0.17, 0.20, 0.14, 0.14, 0.04, 0.11, 0.04, 0.06, 0.07, 0.04, 0.0‚Ä¶
$ area_2021_transport_telecommunications_and_technical_infrastructure &lt;dbl&gt; 36.75, 6.15, 14.50, 4.02, 12.64, 2.54, 3.20, 4.10, 6.42, 4.41, 3.95, 4.35, 8.82, 1.46, 4.51, 3.95, 6.63, 2.51, 0.15, 0.94, 7.28, 9.44, 0.12, 7.87, 4.19, 12.01, 13.70, 3.74, 1.53, 2.59, 1.83, 1.37, 5.54, 3.47, 2.81, 1.41, 2.66, 4.08, 6.33, 1.69, 3.39, 3.49, 4.13, 4.86, 5.55, 2.96, 5.99, 6.41, 3.14, 7.54, 14.10, 12.01, 2.70, 2.12, 4.95, 1.57, 0.76, 1.05, 3.15, 2.77, 9.05, 5.61, 5.24, 2.20, 1.72, 5.14, 14.53, 1.72, 0.18, 2.20, 4.31, 3.10, 2.17, 5.43, 4.62, 3.18, 4.21, 2.12, 3.65, 0.25, 0.34, 1.33, 5.77, 4.23, 4.79, 2.75, 2.37, 5.37, 9.81, 0.49, 5.11, 11.45, 7.70, 12.20, 11.85, 11.60, 11.76, 21.43, 1.96, 3.35, 5.38, 17.05, 1.92, 6.68, 4.01, 3.35, 5.02, 8.09, 4.36, 3.14, 2.57, 10.12, 13.79, 13.67, 1.66, 3.19, 3.11, 13.83, 4.23, 1.43, 18.48, 9.76, 9.49, 6.29, 3.57, 3.06, 5.72, 6.94, 6.32, 4.33, 7.75, 8.58, 8.10, 4.61, 7.66, 7.79, 7.17, 7.62, 4.54, 9.82, 3.21, 5.32, 16.13, 7.22, 9.64, 13.64, 23.25, 6.24, 13.03, 5.9‚Ä¶
$ area_2021_emergency_and_defence_services                            &lt;dbl&gt; 0.66, 0.01, 0.41, 0.02, 0.14, 0.01, 0.00, 0.07, 0.01, 0.00, 0.00, 0.06, 0.09, 0.00, 0.01, 0.00, 0.01, 0.00, 0.00, 0.00, 0.00, 0.02, 0.00, 0.02, 0.03, 0.04, 0.07, 0.02, 0.00, 0.00, 0.01, 0.01, 0.00, 0.00, 0.00, 0.02, 0.01, 0.00, 0.31, 0.01, 0.00, 0.00, 0.03, 0.01, 0.02, 0.02, 0.01, 0.03, 0.00, 0.04, 0.29, 0.34, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.10, 0.00, 0.00, 0.00, 0.00, 0.01, 0.02, 0.00, 0.00, 0.00, 0.01, 0.01, 0.00, 0.09, 0.04, 0.00, 0.00, 0.00, 0.64, 0.00, 0.01, 0.00, 0.01, 0.02, 0.03, 0.00, 0.00, 0.04, 0.26, 0.00, 0.00, 0.03, 0.26, 0.01, 0.27, 0.01, 0.35, 0.36, 0.00, 0.00, 0.01, 0.03, 0.00, 0.00, 0.24, 0.01, 0.00, 0.22, 0.01, 0.11, 0.01, 0.21, 0.04, 0.01, 0.05, 0.01, 0.03, 0.31, 0.00, 0.00, 0.85, 0.00, 0.03, 0.01, 0.00, 0.05, 0.00, 0.01, 0.00, 0.00, 0.03, 0.01, 0.00, 0.00, 0.01, 0.01, 0.03, 0.00, 0.01, 0.00, 0.00, 0.00, 0.12, 0.03, 0.37, 0.01, 0.01, 0.01, 0.01, 0.00, 0.01, 0.00, 0.00, 0.0‚Ä¶
$ area_2021_green_areas_and_sports_facilities                         &lt;dbl&gt; 9.78, 0.49, 2.81, 0.71, 2.14, 0.21, 0.10, 0.57, 0.81, 0.46, 0.66, 0.44, 1.53, 0.39, 0.37, 0.11, 0.27, 0.45, 0.03, 0.03, 0.57, 1.40, 0.02, 0.37, 0.53, 1.44, 2.03, 0.26, 0.18, 0.19, 0.20, 0.34, 0.59, 1.71, 0.38, 0.19, 0.35, 0.46, 0.60, 0.16, 0.21, 0.14, 0.25, 0.62, 0.61, 0.13, 0.17, 0.91, 0.42, 0.79, 2.12, 2.43, 0.14, 0.07, 0.29, 0.06, 0.03, 0.09, 0.30, 0.11, 0.83, 0.13, 0.12, 0.09, 0.13, 0.17, 1.75, 0.10, 0.02, 0.06, 0.38, 0.12, 0.09, 0.25, 0.61, 0.14, 0.16, 0.10, 0.11, 0.03, 0.02, 0.04, 0.53, 0.84, 0.25, 0.16, 0.17, 0.73, 0.66, 0.04, 0.14, 0.84, 1.57, 1.87, 2.84, 3.41, 1.86, 1.27, 0.29, 0.16, 0.14, 2.44, 0.09, 0.85, 0.21, 0.29, 0.68, 1.81, 0.56, 0.70, 0.25, 4.47, 2.71, 1.15, 0.35, 0.65, 1.44, 2.11, 1.96, 0.47, 1.75, 1.62, 0.58, 0.53, 0.31, 0.70, 0.12, 1.53, 1.19, 1.86, 0.85, 2.64, 0.32, 0.82, 0.73, 0.62, 1.49, 0.41, 0.16, 0.85, 0.29, 0.30, 1.49, 0.95, 1.03, 1.24, 1.98, 0.42, 1.25, 0.25, 0.36, 0.70, 0.35, 0.6‚Ä¶
$ area_2021_unclassified_built_up_areas_and_related_land              &lt;dbl&gt; 8.32, 0.81, 3.21, 1.19, 2.55, 0.21, 0.18, 0.25, 0.84, 0.79, 0.97, 0.53, 1.23, 0.38, 0.82, 0.29, 0.37, 0.25, 0.03, 0.11, 1.28, 2.36, 0.03, 0.95, 0.86, 1.58, 3.43, 0.37, 0.30, 0.81, 0.39, 0.41, 0.80, 0.36, 0.52, 0.54, 0.71, 0.65, 0.63, 0.30, 0.54, 0.31, 0.43, 0.63, 0.69, 0.29, 0.39, 0.76, 0.38, 1.23, 1.81, 1.95, 0.19, 0.19, 0.52, 0.15, 0.07, 0.19, 0.46, 0.37, 0.79, 0.18, 0.12, 0.20, 0.09, 0.26, 0.91, 0.04, 0.01, 0.05, 0.31, 0.09, 0.02, 0.26, 0.92, 0.27, 0.27, 0.20, 0.23, 0.05, 0.13, 0.18, 0.87, 0.66, 0.61, 0.25, 0.40, 0.42, 0.21, 0.15, 0.36, 1.51, 1.42, 1.52, 2.49, 2.54, 1.40, 2.12, 0.19, 0.14, 0.34, 2.13, 0.23, 0.64, 0.34, 0.41, 0.91, 1.33, 0.74, 0.52, 0.64, 2.63, 4.14, 1.16, 0.46, 0.51, 0.78, 1.73, 0.70, 0.23, 1.48, 1.47, 0.97, 0.47, 0.30, 0.40, 0.18, 0.50, 0.24, 0.29, 0.25, 0.18, 0.59, 0.37, 0.89, 1.00, 1.38, 0.30, 0.21, 0.22, 0.42, 0.64, 1.33, 1.08, 1.70, 1.32, 2.81, 0.42, 1.23, 0.42, 0.67, 0.62, 0.42, 0.6‚Ä¶
$ area_2021_agricultural_land                                         &lt;dbl&gt; 9.60, 52.14, 92.91, 9.14, 89.80, 16.75, 24.57, 60.74, 118.94, 74.25, 83.45, 55.25, 35.43, 14.72, 27.35, 40.64, 35.16, 8.31, 3.44, 9.54, 56.49, 58.49, 1.48, 80.91, 4.85, 46.89, 42.05, 26.10, 10.25, 7.50, 5.69, 4.94, 36.20, 17.96, 14.47, 2.78, 11.52, 22.83, 35.41, 10.75, 22.44, 26.19, 20.60, 24.71, 38.44, 18.89, 24.96, 33.79, 18.92, 79.39, 35.19, 24.16, 14.02, 31.15, 36.28, 17.06, 9.07, 11.67, 29.45, 24.87, 37.48, 9.65, 36.32, 20.95, 15.44, 24.72, 32.93, 11.08, 0.67, 10.22, 18.51, 14.81, 12.53, 14.04, 19.93, 8.49, 33.68, 6.69, 8.91, 1.40, 1.16, 5.15, 41.33, 12.06, 25.22, 18.79, 10.46, 28.30, 24.19, 0.58, 15.93, 61.55, 33.60, 78.12, 67.39, 26.01, 40.17, 77.73, 4.76, 20.86, 40.01, 235.68, 32.57, 109.71, 35.31, 34.96, 34.88, 38.93, 37.71, 15.30, 5.03, 14.39, 40.64, 104.14, 6.26, 30.36, 5.86, 117.74, 17.06, 26.21, 88.50, 141.56, 53.51, 51.83, 7.90, 22.27, 7.35, 17.59, 25.22, 22.12, 40.10, 20.54, 35.57, 10.35, 52.2‚Ä¶
$ area_2021_forest                                                    &lt;dbl&gt; 279.30, 83.02, 80.63, 20.73, 215.91, 60.98, 121.74, 113.52, 16.42, 5.08, 17.12, 97.32, 3.75, 1.49, 123.23, 296.76, 595.47, 118.94, 0.00, 5.40, 165.70, 39.31, 0.18, 275.45, 46.98, 489.57, 270.36, 68.09, 11.13, 13.03, 18.31, 21.31, 188.95, 223.66, 128.83, 23.32, 2.39, 189.39, 379.15, 11.97, 66.69, 199.19, 224.07, 332.08, 455.33, 8.69, 320.03, 270.09, 269.47, 196.36, 545.74, 835.81, 387.48, 69.51, 292.09, 13.65, 97.72, 4.14, 50.08, 124.01, 674.33, 705.00, 808.09, 37.38, 57.54, 531.95, 1007.77, 73.80, 0.00, 142.32, 198.73, 189.96, 308.67, 519.92, 300.21, 435.66, 385.29, 184.36, 149.49, 0.00, 0.02, 8.62, 60.81, 133.56, 213.64, 68.57, 93.44, 298.75, 162.99, 1.39, 637.75, 480.39, 60.03, 241.20, 138.60, 225.58, 616.43, 1190.86, 34.03, 245.44, 304.58, 451.14, 53.75, 282.96, 53.54, 192.11, 77.37, 124.24, 46.05, 54.27, 42.22, 120.58, 254.82, 857.40, 42.49, 150.51, 46.40, 235.65, 141.42, 47.59, 117.12, 418.69, 293.99, 2‚Ä¶
$ area_2021_open_firm_ground                                          &lt;dbl&gt; 7.55, 216.78, 23.07, 18.13, 521.59, 165.91, 188.31, 368.19, 78.49, 5.89, 46.87, 364.82, 6.49, 1.86, 62.20, 528.31, 818.84, 321.92, 1.60, 25.25, 143.15, 73.82, 3.35, 202.35, 14.90, 592.96, 200.22, 234.44, 61.52, 80.55, 57.77, 38.48, 258.42, 377.52, 125.74, 23.78, 14.61, 138.71, 567.72, 20.77, 60.66, 107.65, 50.78, 822.37, 659.92, 147.25, 223.17, 391.69, 461.82, 146.07, 542.35, 1400.98, 626.84, 64.46, 459.76, 106.97, 277.31, 38.91, 57.29, 207.80, 847.93, 856.49, 1252.48, 106.65, 83.16, 638.39, 2239.28, 131.28, 12.50, 334.86, 249.82, 330.56, 632.46, 1227.25, 508.36, 592.27, 364.43, 245.33, 45.55, 6.17, 11.80, 120.10, 233.13, 216.77, 211.34, 98.67, 132.98, 217.51, 180.95, 85.45, 750.60, 2.88, 4.09, 8.22, 8.91, 2.59, 15.40, 47.93, 5.65, 0.94, 1.71, 8.81, 0.75, 3.23, 3.57, 2.06, 3.52, 3.21, 2.28, 1.21, 0.83, 4.96, 5.08, 4.81, 0.97, 1.46, 1.05, 8.44, 1.41, 0.61, 4.15, 3.54, 4.24, 1.85, 0.81, 1.55, 159.30, 133.12, 8‚Ä¶
$ area_2021_wetland                                                   &lt;dbl&gt; 4.09, 13.50, 5.72, 3.30, 9.87, 9.99, 6.70, 15.98, 12.97, 0.55, 9.36, 8.41, 0.36, 0.09, 2.87, 22.54, 17.53, 8.40, 0.03, 2.08, 12.94, 11.33, 0.04, 18.28, 3.85, 50.85, 36.33, 14.66, 2.39, 5.29, 4.71, 6.02, 5.69, 12.75, 12.20, 0.51, 2.44, 17.23, 21.35, 10.32, 11.46, 27.59, 15.15, 18.43, 80.50, 72.38, 34.71, 13.88, 12.06, 54.52, 57.92, 54.50, 22.24, 6.47, 21.96, 9.90, 2.56, 1.59, 4.67, 20.62, 70.09, 111.61, 144.50, 9.09, 3.19, 63.69, 100.35, 5.10, 0.27, 10.66, 13.42, 11.42, 14.95, 45.82, 36.49, 30.26, 36.43, 13.63, 18.58, 0.09, 0.26, 4.30, 37.72, 28.76, 29.41, 30.02, 42.63, 75.73, 204.36, 0.21, 42.56, 16.21, 0.21, 1.70, 0.23, 5.00, 32.09, 50.78, 0.16, 7.24, 10.49, 7.46, 0.20, 7.96, 0.41, 1.58, 0.12, 0.95, 0.21, 0.11, 0.21, 0.67, 1.58, 53.65, 0.44, 1.81, 0.23, 2.98, 3.53, 2.68, 1.11, 20.15, 7.61, 9.28, 8.75, 2.17, 45.17, 74.40, 59.38, 32.05, 102.76, 84.30, 41.63, 11.29, 10.51, 7.72, 3.98, 22.37, 27.03, 175.26, 9.1‚Ä¶
$ area_2021_bare_rock_gravel_and_blockfields                          &lt;dbl&gt; 0.52, 4.57, 1.19, 0.74, 63.49, 3.90, 4.46, 7.11, 1.56, 0.69, 0.22, 19.28, 0.76, 0.09, 4.97, 51.53, 98.29, 41.34, 0.65, 0.28, 1.25, 2.42, 0.88, 1.66, 1.92, 213.87, 11.43, 11.10, 0.81, 2.56, 2.08, 1.00, 140.75, 184.30, 34.40, 0.56, 1.25, 18.40, 352.71, 0.37, 1.79, 2.28, 1.24, 426.30, 64.25, 6.12, 4.17, 105.12, 344.71, 7.66, 93.69, 733.08, 134.70, 15.27, 174.25, 9.95, 127.57, 3.82, 35.94, 66.14, 180.55, 176.39, 146.79, 7.58, 17.76, 104.75, 553.53, 31.44, 2.37, 134.21, 134.17, 62.76, 145.37, 254.45, 121.03, 357.95, 129.93, 51.39, 11.61, 1.04, 4.02, 27.89, 17.30, 56.54, 57.10, 12.56, 24.17, 62.47, 23.28, 20.99, 368.66, 1.30, 0.48, 1.55, 15.41, 1.17, 18.85, 3.21, 33.54, 0.02, 0.04, 0.11, 0.01, 0.01, 1.02, 0.02, 0.23, 0.07, 0.02, 0.13, 0.20, 0.25, 2.49, 0.04, 0.01, 0.08, 0.02, 0.14, 0.11, 0.01, 0.00, 0.01, 0.36, 0.06, 0.12, 0.52, 6.60, 3.13, 1.45, 128.67, 153.00, 154.92, 1.67, 0.55, 1.03, 0.26, 0.83, 1.55, 2.53, 5.‚Ä¶
$ area_2021_permanent_snow_and_glaciers                               &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 1.53, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 7.08, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 3.46, 17.42, 3.51, 0.00, 0.00, 0.00, 16.49, 0.00, 0.00, 0.00, 0.00, 9.38, 0.88, 0.00, 0.00, 1.93, 27.92, 0.00, 0.35, 111.75, 0.05, 0.00, 1.06, 0.00, 0.34, 0.00, 0.00, 0.00, 5.48, 13.66, 14.71, 0.00, 0.00, 55.69, 226.52, 0.00, 0.00, 48.25, 170.79, 4.37, 60.29, 8.74, 106.05, 34.59, 4.43, 0.97, 0.43, 0.00, 0.00, 0.00, 0.00, 0.35, 2.22, 0.00, 0.00, 0.08, 0.00, 0.00, 9.47, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.04, 0.21, 9.20, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00‚Ä¶
$ area_2021_inland_waters                                             &lt;dbl&gt; 28.32, 46.55, 6.35, 4.45, 97.18, 28.00, 56.36, 76.87, 10.97, 11.17, 13.05, 61.60, 0.30, 0.62, 26.54, 119.38, 155.83, 40.67, 0.02, 2.65, 25.96, 11.01, 0.04, 23.52, 1.33, 70.25, 26.31, 21.47, 3.21, 1.79, 2.48, 5.64, 13.90, 22.89, 10.02, 1.65, 0.76, 6.31, 60.80, 0.27, 2.70, 11.64, 15.80, 67.95, 52.31, 12.28, 21.24, 45.74, 48.27, 15.55, 85.40, 240.41, 73.64, 4.04, 48.34, 2.29, 22.78, 0.85, 1.25, 15.87, 93.75, 123.20, 273.44, 6.49, 2.24, 159.13, 261.82, 7.73, 0.12, 26.57, 76.80, 43.39, 43.25, 134.66, 104.45, 171.62, 47.64, 20.43, 11.55, 0.59, 0.08, 9.71, 18.37, 20.13, 16.19, 12.03, 9.72, 25.93, 44.89, 8.59, 185.91, 48.71, 10.11, 33.47, 8.59, 13.19, 39.65, 134.27, 0.21, 38.57, 45.95, 38.33, 8.19, 14.64, 13.27, 18.02, 0.68, 7.02, 2.06, 1.17, 0.81, 4.20, 13.43, 93.88, 15.01, 37.54, 3.45, 46.32, 7.31, 1.15, 2.83, 29.16, 71.69, 17.73, 24.65, 57.91, 36.18, 40.90, 19.47, 43.18, 93.92, 201.74, 32.68, 35.43, 53.99, 40.18,‚Ä¶
$ area_2021_unclassified_undeveloped_areas                            &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.03, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.03, 0.00, 0.00, 0.02, 0.03, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.02, 0.02, 0.02, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.02, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.0‚Ä¶
$ total_area                                                          &lt;dbl&gt; 454.13, 432.42, 262.42, 72.60, 1040.63, 294.95, 408.40, 650.54, 257.96, 113.39, 183.18, 617.95, 69.10, 24.71, 261.71, 1068.08, 1736.24, 546.54, 6.25, 47.20, 425.37, 229.87, 6.30, 620.45, 87.41, 1503.36, 632.62, 385.13, 93.28, 119.44, 97.23, 82.32, 661.61, 865.85, 337.78, 58.53, 40.59, 404.64, 1448.06, 60.66, 175.25, 381.65, 336.71, 1713.36, 1365.33, 271.62, 640.22, 876.89, 1190.60, 521.81, 1395.17, 3432.12, 1264.01, 195.38, 1046.07, 163.34, 538.96, 64.18, 187.63, 465.33, 1928.93, 2004.14, 2684.33, 192.51, 183.33, 1588.79, 4460.07, 264.67, 16.51, 711.07, 873.21, 664.60, 1221.63, 2216.19, 1209.82, 1637.30, 1009.82, 527.38, 252.72, 10.11, 18.52, 178.67, 424.15, 478.98, 566.58, 246.74, 319.60, 722.30, 656.59, 118.72, 2020.66, 642.45, 137.92, 405.62, 292.16, 317.68, 793.10, 1555.09, 89.97, 319.26, 412.91, 791.79, 101.18, 434.87, 118.83, 256.97, 133.97, 202.98, 102.70, 85.73, 61.48, 192.28, 376.72, 1144.80, 71.69,‚Ä¶
$ kommune_code                                                        &lt;chr&gt; &quot;0301&quot;, &quot;1101&quot;, &quot;1103&quot;, &quot;1106&quot;, &quot;1108&quot;, &quot;1111&quot;, &quot;1112&quot;, &quot;1114&quot;, &quot;1119&quot;, &quot;1120&quot;, &quot;1121&quot;, &quot;1122&quot;, &quot;1124&quot;, &quot;1127&quot;, &quot;1130&quot;, &quot;1133&quot;, &quot;1134&quot;, &quot;1135&quot;, &quot;1144&quot;, &quot;1145&quot;, &quot;1146&quot;, &quot;1149&quot;, &quot;1151&quot;, &quot;1160&quot;, &quot;1505&quot;, &quot;1506&quot;, &quot;1507&quot;, &quot;1511&quot;, &quot;1514&quot;, &quot;1515&quot;, &quot;1516&quot;, &quot;1517&quot;, &quot;1520&quot;, &quot;1525&quot;, &quot;1528&quot;, &quot;1531&quot;, &quot;1532&quot;, &quot;1535&quot;, &quot;1539&quot;, &quot;1547&quot;, &quot;1554&quot;, &quot;1557&quot;, &quot;1560&quot;, &quot;1563&quot;, &quot;1566&quot;, &quot;1573&quot;, &quot;1576&quot;, &quot;1577&quot;, &quot;1578&quot;, &quot;1579&quot;, &quot;1804&quot;, &quot;1806&quot;, &quot;1811&quot;, &quot;1812&quot;, &quot;1813&quot;, &quot;1815&quot;, &quot;1816&quot;, &quot;1818&quot;, &quot;1820&quot;, &quot;1822&quot;, &quot;1824&quot;, &quot;1825&quot;, &quot;1826&quot;, &quot;1827&quot;, &quot;1828&quot;, &quot;1832&quot;, &quot;1833&quot;, &quot;1834&quot;, &quot;1835&quot;, &quot;1836&quot;, &quot;1837&quot;, &quot;1838&quot;, &quot;1839&quot;, &quot;1840&quot;, &quot;1841&quot;, &quot;1845&quot;, &quot;1848&quot;, &quot;1851&quot;, &quot;1853&quot;, &quot;1856&quot;, &quot;1857&quot;, &quot;1859&quot;, &quot;1860&quot;, &quot;1865&quot;, &quot;1866&quot;, &quot;1867&quot;, &quot;1868&quot;, &quot;1870&quot;, &quot;1871&quot;, &quot;1874&quot;, &quot;1875&quot;, &quot;3001&quot;, &quot;3002&quot;, &quot;3003&quot;, &quot;3004&quot;, &quot;3005&quot;, &quot;3006&quot;, &quot;3007&quot;, &quot;3011&quot;, &quot;3012&quot;, &quot;3013&quot;, &quot;3014&quot;, &quot;3015&quot;, &quot;3016&quot;, &quot;3017&quot;, &quot;3018&quot;, &quot;3019&quot;, &quot;3020&quot;, &quot;3021&quot;, &quot;3022&quot;, &quot;3023&quot;, &quot;3024&quot;, &quot;3025&quot;, &quot;3026&quot;, &quot;3027&quot;, &quot;‚Ä¶
$ location_code                                                       &lt;glue&gt; &quot;municip_nor0301&quot;, &quot;municip_nor1101&quot;, &quot;municip_nor1103&quot;, &quot;municip_nor1106&quot;, &quot;municip_nor1108&quot;, &quot;municip_nor1111&quot;, &quot;municip_nor1112&quot;, &quot;municip_nor1114&quot;, &quot;municip_nor1119&quot;, &quot;municip_nor1120&quot;, &quot;municip_nor1121&quot;, &quot;municip_nor1122&quot;, &quot;municip_nor1124&quot;, &quot;municip_nor1127&quot;, &quot;municip_nor1130&quot;, &quot;municip_nor1133&quot;, &quot;municip_nor1134&quot;, &quot;municip_nor1135&quot;, &quot;municip_nor1144&quot;, &quot;municip_nor1145&quot;, &quot;municip_nor1146&quot;, &quot;municip_nor1149&quot;, &quot;municip_nor1151&quot;, &quot;municip_nor1160&quot;, &quot;municip_nor1505&quot;, &quot;municip_nor1506&quot;, &quot;municip_nor1507&quot;, &quot;municip_nor1511&quot;, &quot;municip_nor1514&quot;, &quot;municip_nor1515&quot;, &quot;municip_nor1516&quot;, &quot;municip_nor1517&quot;, &quot;municip_nor1520&quot;, &quot;municip_nor1525&quot;, &quot;municip_nor1528&quot;, &quot;municip_nor1531&quot;, &quot;municip_nor1532&quot;, &quot;municip_nor1535&quot;, &quot;municip_nor1539&quot;, &quot;municip_nor1547&quot;, &quot;municip_nor1554&quot;, &quot;municip_nor1557&quot;, &quot;municip_nor1560&quot;, &quot;municip_nor1563&quot;, &quot;municip_nor1566&quot;, &quot;municip_nor1573&quot;, &quot;municip_nor1576&quot;, &quot;municip_nor1577&quot;, &quot;municip‚Ä¶
$ perc_rocks                                                          &lt;dbl&gt; 1.145047e-03, 1.056843e-02, 4.534715e-03, 1.019284e-02, 6.101112e-02, 1.322258e-02, 1.092067e-02, 1.092938e-02, 6.047449e-03, 6.085193e-03, 1.201004e-03, 3.119994e-02, 1.099855e-02, 3.642250e-03, 1.899049e-02, 4.824545e-02, 5.661084e-02, 7.563948e-02, 1.040000e-01, 5.932203e-03, 2.938618e-03, 1.052769e-02, 1.396825e-01, 2.675477e-03, 2.196545e-02, 1.422613e-01, 1.806772e-02, 2.882144e-02, 8.683533e-03, 2.143336e-02, 2.139257e-02, 1.214772e-02, 2.127386e-01, 2.128544e-01, 1.018414e-01, 9.567743e-03, 3.079576e-02, 4.547252e-02, 2.435742e-01, 6.099571e-03, 1.021398e-02, 5.974060e-03, 3.682694e-03, 2.488094e-01, 4.705822e-02, 2.253148e-02, 6.513386e-03, 1.198782e-01, 2.895263e-01, 1.467967e-02, 6.715311e-02, 2.135939e-01, 1.065656e-01, 7.815539e-02, 1.665759e-01, 6.091588e-02, 2.366966e-01, 5.952010e-02, 1.915472e-01, 1.421357e-01, 9.360112e-02, 8.801281e-02, 5.468404e-02, 3.937458e-02, 9.687449e-02, 6.593068e-0‚Ä¶
$ perc_wetland                                                        &lt;dbl&gt; 0.0090062317, 0.0312196476, 0.0217971191, 0.0454545455, 0.0094846391, 0.0338701475, 0.0164054848, 0.0245642082, 0.0502791130, 0.0048505159, 0.0510972814, 0.0136095153, 0.0052098408, 0.0036422501, 0.0109663368, 0.0211032881, 0.0100965304, 0.0153694149, 0.0048000000, 0.0440677966, 0.0304205750, 0.0492887284, 0.0063492063, 0.0294624869, 0.0440453037, 0.0338242337, 0.0574278398, 0.0380650689, 0.0256217839, 0.0442900201, 0.0484418389, 0.0731292517, 0.0086002328, 0.0147254143, 0.0361181834, 0.0087134803, 0.0601133284, 0.0425810597, 0.0147438642, 0.1701285856, 0.0653922967, 0.0722913664, 0.0449942087, 0.0107566419, 0.0589601049, 0.2664752227, 0.0542157383, 0.0158286672, 0.0101293465, 0.1044824745, 0.0415146541, 0.0158793982, 0.0175947975, 0.0331149555, 0.0209928590, 0.0606097710, 0.0047498887, 0.0247740729, 0.0248894100, 0.0443126383, 0.0363362071, 0.0556897223, 0.0538309373, 0.0472183263, 0.0174003164, 0.040087110‚Ä¶
$ perc_forest                                                         &lt;dbl&gt; 0.615022130, 0.191989270, 0.307255545, 0.285537190, 0.207480084, 0.206746906, 0.298090108, 0.174501184, 0.063653280, 0.044801129, 0.093459985, 0.157488470, 0.054269175, 0.060299474, 0.470864698, 0.277844356, 0.342965258, 0.217623596, 0.000000000, 0.114406780, 0.389543221, 0.171009701, 0.028571429, 0.443951970, 0.537467109, 0.325650543, 0.427365559, 0.176797445, 0.119318182, 0.109092431, 0.188316363, 0.258867833, 0.285591209, 0.258312641, 0.381402096, 0.398428157, 0.058881498, 0.468045670, 0.261833073, 0.197329377, 0.380542083, 0.521917988, 0.665468801, 0.193817995, 0.333494467, 0.031993226, 0.499875043, 0.308008986, 0.226331262, 0.376305552, 0.391163801, 0.243525867, 0.306548208, 0.355768246, 0.279226056, 0.083568018, 0.181312157, 0.064506077, 0.266908277, 0.266499044, 0.349587595, 0.351771832, 0.301039738, 0.194171731, 0.313860252, 0.334814544, 0.225953853, 0.278837798, 0.000000000, 0.200149071, 0.227585575‚Ä¶
$ perc_open_ground                                                    &lt;dbl&gt; 0.016625195, 0.501318163, 0.087912507, 0.249724518, 0.501225219, 0.562502119, 0.461092067, 0.565975958, 0.304271980, 0.051944616, 0.255868545, 0.590371389, 0.093921852, 0.075273169, 0.237667647, 0.494635233, 0.471616827, 0.589014528, 0.256000000, 0.534957627, 0.336530550, 0.321138035, 0.531746032, 0.326134257, 0.170461046, 0.394423159, 0.316493314, 0.608729520, 0.659519726, 0.674397187, 0.594158182, 0.467444121, 0.390592645, 0.436010856, 0.372254130, 0.406287374, 0.359940872, 0.342798537, 0.392055578, 0.342400264, 0.346134094, 0.282064719, 0.150812272, 0.479975020, 0.483341024, 0.542117664, 0.348583299, 0.446680884, 0.387888460, 0.279929476, 0.388733989, 0.408196683, 0.495913798, 0.329921179, 0.439511696, 0.654891637, 0.514527980, 0.606263634, 0.305334968, 0.446564803, 0.439585677, 0.427360364, 0.466589428, 0.553997195, 0.453608247, 0.401808924, 0.502072837, 0.496013904, 0.757116899, 0.470924100, 0.286093838‚Ä¶
</code></pre>
<p>Then the next step is very similar to what we&rsquo;ve done before. We&rsquo;ll use <code>left_join</code> to merge the data frame containing the land use variables with the data frame containing the map with the kommune borders. I want to plot the four designations of interest in one figure, so I&rsquo;ll transform the plot to a long format using <code>pivot_longer</code>. Then I&rsquo;ll create a new label with nicer descriptions of the designations, and then the rest is similar to before. We&rsquo;ll facet the plot based on the designation:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">nor_municip_map_b2020_split_dt</span> <span class="o">|&gt;</span> 
  <span class="nf">left_join</span><span class="p">(</span><span class="n">area_use</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s">&#34;location_code&#34;</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="nf">pivot_longer</span><span class="p">(</span><span class="n">cols</span> <span class="o">=</span> <span class="nf">starts_with</span><span class="p">(</span><span class="s">&#34;perc&#34;</span><span class="p">),</span> <span class="n">names_to</span> <span class="o">=</span> <span class="s">&#34;land_type&#34;</span><span class="p">,</span> <span class="n">values_to</span> <span class="o">=</span> <span class="s">&#34;percentage&#34;</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="nf">mutate</span><span class="p">(</span><span class="n">land_type_label</span> <span class="o">=</span> <span class="nf">case_when</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">land_type</span><span class="p">,</span> <span class="s">&#34;rocks&#34;</span><span class="p">)</span> <span class="o">~</span> <span class="s">&#34;Bare rock, gravel and rockfields&#34;</span><span class="p">,</span>
                                     <span class="nf">str_detect</span><span class="p">(</span><span class="n">land_type</span><span class="p">,</span> <span class="s">&#34;wetland&#34;</span><span class="p">)</span> <span class="o">~</span> <span class="s">&#34;Wetland&#34;</span><span class="p">,</span>
                                     <span class="nf">str_detect</span><span class="p">(</span><span class="n">land_type</span><span class="p">,</span> <span class="s">&#34;forest&#34;</span><span class="p">)</span> <span class="o">~</span> <span class="s">&#34;Forest&#34;</span><span class="p">,</span>
                                     <span class="nf">str_detect</span><span class="p">(</span><span class="n">land_type</span><span class="p">,</span> <span class="s">&#34;open_ground&#34;</span><span class="p">)</span> <span class="o">~</span> <span class="s">&#34;Open firm ground&#34;</span><span class="p">))</span> <span class="o">|&gt;</span> 
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">long</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">percentage</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_polygon</span><span class="p">()</span> <span class="o">+</span> 
  <span class="nf">labs</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;Percentage&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">scico</span><span class="o">::</span><span class="nf">scale_fill_scico</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s">&#34;acton&#34;</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">label_percent</span><span class="p">(),</span> <span class="n">limits</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span>
                          <span class="n">guide</span> <span class="o">=</span> <span class="nf">guide_colorbar</span><span class="p">(</span><span class="n">barheight</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">barwidth</span> <span class="o">=</span> <span class="m">12</span><span class="p">,</span> 
                                                 <span class="n">ticks</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="s">&#34;horizontal&#34;</span><span class="p">,</span>
                                                 <span class="n">title.position</span> <span class="o">=</span> <span class="s">&#34;top&#34;</span><span class="p">,</span> <span class="n">title.hjust</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span> <span class="n">land_type_label</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">coord_map</span><span class="p">(</span><span class="n">projection</span> <span class="o">=</span> <span class="s">&#34;conic&#34;</span><span class="p">,</span> <span class="n">lat0</span> <span class="o">=</span> <span class="m">60</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">theme_void</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&#34;bottom&#34;</span><span class="p">,</span>
        <span class="n">strip.text.x</span> <span class="o">=</span> <span class="nf">element_textbox_simple</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="nf">rel</span><span class="p">(</span><span class="m">1.25</span><span class="p">),</span> <span class="n">halign</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span>
                                              <span class="n">margin</span> <span class="o">=</span> <span class="nf">margin</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;pt&#34;</span><span class="p">)))</span>
</code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/plot-kommune-faceted-1.png" width="768" />
<h2 id="oslo">Oslo</h2>
<p>The last thing I want to show is a map of Oslo! <code>{csmaps}</code> contains a detailed map of the bydeler that we will use. Now, these bydeler are again coded and <code>{csdata}</code> (since it&rsquo;s update) now contains a <a href="https://www.csids.no/csmaps/articles/customization.html#add-location-name-for-ward-and-population-for-oslo-map">data frame</a> with the corresponding names for all geography levels (fylker, municipalities, bydeler, etc.). We could get our data from there, but we also need something to visualize so we&rsquo;ll scrape a Wikipedia article for Oslo&rsquo;s bydeler which contains a table with the bydel numbers, the names, and some data we can use for visualization. We&rsquo;ll extract the table from the website using <code>{rvest}</code>, do some data wrangling and prepare it for merging into the data frame with the map. I won&rsquo;t go into the wrangling much here, we&rsquo;re interested mainly in the plotting of the data right now.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">bydel_data</span> <span class="o">&lt;-</span> <span class="s">&#34;https://en.wikipedia.org/wiki/List_of_boroughs_of_Oslo&#34;</span> <span class="o">|&gt;</span> 
  <span class="n">rvest</span><span class="o">::</span><span class="nf">read_html</span><span class="p">()</span> <span class="o">|&gt;</span> 
  <span class="n">rvest</span><span class="o">::</span><span class="nf">html_table</span><span class="p">()</span> <span class="o">|&gt;</span> 
  <span class="nf">pluck</span><span class="p">(</span><span class="m">1</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="n">janitor</span><span class="o">::</span><span class="nf">clean_names</span><span class="p">()</span> <span class="o">|&gt;</span> 
  <span class="nf">mutate</span><span class="p">(</span><span class="n">inhabitants</span> <span class="o">=</span> <span class="nf">str_remove_all</span><span class="p">(</span><span class="n">residents</span><span class="p">,</span> <span class="s">&#34;[[:blank:]]&#34;</span><span class="p">),</span>
         <span class="n">inhabitants</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">inhabitants</span><span class="p">),</span>
         <span class="n">area</span> <span class="o">=</span> <span class="nf">str_remove_all</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="s">&#34;km2&#34;</span><span class="p">),</span>
         <span class="n">area</span> <span class="o">=</span> <span class="nf">str_replace_all</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="s">&#34;,&#34;</span><span class="p">,</span> <span class="s">&#34;.&#34;</span><span class="p">),</span>
         <span class="n">area</span> <span class="o">=</span> <span class="nf">str_squish</span><span class="p">(</span><span class="n">area</span><span class="p">),</span>
         <span class="n">area</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">area</span><span class="p">),</span>
         <span class="n">pop_density</span> <span class="o">=</span> <span class="n">inhabitants</span> <span class="o">/</span> <span class="n">area</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="nf">arrange</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="nf">mutate</span><span class="p">(</span><span class="n">bydel_nr</span> <span class="o">=</span> <span class="nf">format</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">digits</span> <span class="o">=</span> <span class="m">2</span><span class="p">),</span>
         <span class="n">bydel_nr</span> <span class="o">=</span> <span class="nf">str_replace_all</span><span class="p">(</span><span class="n">bydel_nr</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">,</span> <span class="s">&#34;0&#34;</span><span class="p">),</span>
         <span class="n">location_code</span> <span class="o">=</span> <span class="nf">str_glue</span><span class="p">(</span><span class="s">&#34;wardoslo_nor0301{bydel_nr}&#34;</span><span class="p">))</span>

<span class="nf">print</span><span class="p">(</span><span class="n">bydel_data</span><span class="p">)</span>
</code></pre></div><pre><code># A tibble: 15 √ó 8
   borough           residents  area number inhabitants pop_density bydel_nr location_code     
   &lt;chr&gt;             &lt;chr&gt;     &lt;dbl&gt;  &lt;int&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;    &lt;glue&gt;            
 1 Gamle Oslo        58 671      7.5      1       58671       7823. 01       wardoslo_nor030101
 2 Gr√ºnerl√∏kka       62 423      4.8      2       62423      13005. 02       wardoslo_nor030102
 3 Sagene            45 089      3.1      3       45089      14545. 03       wardoslo_nor030103
 4 St. Hanshaugen    38 945      3.6      4       38945      10818. 04       wardoslo_nor030104
 5 Frogner           59 269      8.3      5       59269       7141. 05       wardoslo_nor030105
 6 Ullern            34 596      9.4      6       34596       3680. 06       wardoslo_nor030106
 7 Vestre Aker       50 157     16.6      7       50157       3022. 07       wardoslo_nor030107
 8 Nordre Aker       52 327     13.6      8       52327       3848. 08       wardoslo_nor030108
 9 Bjerke            33 422      7.7      9       33422       4341. 09       wardoslo_nor030109
10 Grorud            27 707      8.2     10       27707       3379. 10       wardoslo_nor030110
11 Stovner           33 316      8.2     11       33316       4063. 11       wardoslo_nor030111
12 Alna              49 801     13.7     12       49801       3635. 12       wardoslo_nor030112
13 √òstensj√∏          50 806     12.2     13       50806       4164. 13       wardoslo_nor030113
14 Nordstrand        52 459     16.9     14       52459       3104. 14       wardoslo_nor030114
15 S√∏ndre Nordstrand 39 066     18.4     15       39066       2123. 15       wardoslo_nor030115
</code></pre>
<p><code>{csmaps}</code> also provides a very useful data frame containing the geographical center or best location to put a label to avoid overlap and make it as clear as possible which label corresponds to which bydel. So we&rsquo;ll merge those two together.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">bydel_centres</span> <span class="o">&lt;-</span> <span class="n">oslo_ward_position_geolabels_b2020_default_dt</span> <span class="o">|&gt;</span>
  <span class="nf">inner_join</span><span class="p">(</span><span class="n">bydel_data</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s">&#34;location_code&#34;</span><span class="p">)</span>
</code></pre></div><p>Then we&rsquo;ll create the final plot. This will be more-or-less identical to what we did before.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">oslo_ward_map_b2020_default_dt</span> <span class="o">|&gt;</span>
  <span class="nf">left_join</span><span class="p">(</span><span class="n">bydel_data</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s">&#34;location_code&#34;</span><span class="p">)</span> <span class="o">|&gt;</span> 
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">long</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_polygon</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">pop_density</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">pop_density</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">geom_label</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">bydel_centres</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">borough</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="m">1</span><span class="p">),</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">label.size</span> <span class="o">=</span> <span class="m">0</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">labs</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;N&lt;sup&gt;o&lt;/sup&gt; of inhabitants per km&lt;sup&gt;2&lt;/sup&gt;&#34;</span><span class="p">)</span> <span class="o">+</span> 
  <span class="n">scico</span><span class="o">::</span><span class="nf">scale_color_scico</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s">&#34;turku&#34;</span><span class="p">,</span> <span class="n">limits</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1.5e4</span><span class="p">),</span> <span class="n">guide</span> <span class="o">=</span> <span class="s">&#34;none&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">scico</span><span class="o">::</span><span class="nf">scale_fill_scico</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s">&#34;turku&#34;</span><span class="p">,</span> <span class="n">limits</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1.5e4</span><span class="p">),</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">number_format</span><span class="p">(),</span>
                               <span class="n">guide</span> <span class="o">=</span> <span class="nf">guide_colorbar</span><span class="p">(</span><span class="n">title.position</span> <span class="o">=</span> <span class="s">&#34;top&#34;</span><span class="p">,</span> <span class="n">title.hjust</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span>
                                                      <span class="n">barwidth</span> <span class="o">=</span> <span class="m">15</span><span class="p">,</span> <span class="n">barheight</span> <span class="o">=</span> <span class="m">0.75</span><span class="p">,</span> <span class="n">ticks</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">theme_void</span><span class="p">()</span> <span class="o">+</span> 
  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&#34;bottom&#34;</span><span class="p">,</span>
        <span class="n">legend.title</span> <span class="o">=</span> <span class="nf">element_markdown</span><span class="p">(),</span>
        <span class="n">legend.direction</span> <span class="o">=</span> <span class="s">&#34;horizontal&#34;</span><span class="p">)</span>
</code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/plot-oslo-1.png" width="768" />
<p><strong>BONUS</strong></p>
<p>An example of when you might use the <code>sf</code> data format is in interactive maps. Here&rsquo;s a short example of what that might look like. Here we&rsquo;ll use the <code>{leaflet}</code> package (which is an R wrapper for the homonymous JavaScript library) to create an interactive map where we can zoom and hover on the different fylker. This won&rsquo;t work on printed media, but it might be nice to include in a digital format. You could possibly extract the corresponding HTML and JavaScript code and embed it on a webpage separately.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="nf">library</span><span class="p">(</span><span class="n">leaflet</span><span class="p">)</span>

<span class="n">map_sf</span> <span class="o">&lt;-</span> <span class="n">csmaps</span><span class="o">::</span><span class="n">nor_county_map_b2020_default_sf</span> <span class="o">|&gt;</span>
  <span class="n">sf</span><span class="o">::</span><span class="nf">st_as_sf</span><span class="p">()</span> <span class="o">|&gt;</span> 
  <span class="nf">left_join</span><span class="p">(</span><span class="n">county_names</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s">&#34;location_code&#34;</span><span class="p">)</span>

<span class="n">map_sf</span> <span class="o">|&gt;</span> 
  <span class="nf">leaflet</span><span class="p">()</span> <span class="o">|&gt;</span> 
  <span class="nf">addProviderTiles</span><span class="p">(</span><span class="n">providers</span><span class="o">$</span><span class="n">Esri.WorldStreetMap</span><span class="p">)</span> <span class="o">|&gt;</span>
  <span class="nf">addPolygons</span><span class="p">(</span>
    <span class="n">fillColor</span> <span class="o">=</span> <span class="nf">unname</span><span class="p">(</span><span class="n">county_colors</span><span class="p">),</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">,</span>
    <span class="n">opacity</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span>
    <span class="n">fillOpacity</span> <span class="o">=</span> <span class="m">0.75</span><span class="p">,</span>
    <span class="n">highlightOptions</span> <span class="o">=</span> <span class="nf">highlightOptions</span><span class="p">(</span>
      <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#333&#34;</span><span class="p">,</span> <span class="n">bringToFront</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span>
      <span class="n">weight</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">opacity</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre></div><iframe seamless src="leafMap.html" width="100%" height="500" frameBorder="0" style="padding-top: 1em;">
</iframe>
<p><strong>EDIT (2022-09-04)</strong>: Updated the blogpost to replace usage of the retiring <code>{fhimaps}</code> and <code>{fhidata}</code> packages with the newer <code>{splmaps}</code> and <code>{spldata}</code> packages from FHI. The <code>{fhidata}</code> package included a dataset on vaccination rates in Norway, but since this isn&rsquo;t incorporated in the new <code>{spldata}</code> package I replaced that plot with a plot about age distribution.
In addition, I also replaced all usage of the NORMENT internal <code>{normentR}</code> package with the <code>{scico}</code> package which is available on CRAN.</p>
<p><strong>EDIT (2023-06-18)</strong>: Updated the blogpost to reflect the deprecation of the <code>{splmaps}</code> and <code>{spldata}</code> packages. Replaced them with the replacement package <code>{csmaps}</code> available on CRAN.</p>

  </article>

  <br/>

  
  
</section>

      </div>
      
        
<footer class="footer">
  <script src="https://yihui.org/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.min.js"></script>
</footer>
      
    </main>

    

  <script src="/js/app.js"></script>
  
  </body>
</html>
